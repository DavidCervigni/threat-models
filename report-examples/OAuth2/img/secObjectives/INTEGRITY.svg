<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="2014pt" height="6116pt"
 viewBox="0.00 0.00 2014.15 6116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 6112)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-6112 2010.15,-6112 2010.15,4 -4,4"/>
<!-- INTEGRITY -->
<g id="node1" class="node">
<title>INTEGRITY</title>
<ellipse fill="#bae9ff" stroke="#2bbcff" cx="246.07" cy="-2279" rx="246.15" ry="25.41"/>
<text text-anchor="start" x="210.07" y="-2282.4" font-family="Arial" font-weight="bold" font-size="12.00">INTEGRITY</text>
<text text-anchor="start" x="82.07" y="-2270.4" font-family="Arial" font-size="12.00">Ability to maintain fundamental integrity of the system</text>
</g>
<!-- Client_Secrets_disclosure -->
<g id="node2" class="node">
<title>Client_Secrets_disclosure</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1094.65,-5851.5 599.65,-5851.5 599.65,-5770.5 1094.65,-5770.5 1094.65,-5851.5"/>
<text text-anchor="start" x="732.15" y="-5836.4" font-family="Arial" font-weight="bold" font-size="12.00">Client_Secrets_disclosure ATTACK</text>
<text text-anchor="start" x="959.15" y="-5836.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="625.15" y="-5818.4" font-family="Arial" font-size="12.00">Obtain Secret From Source Code or Binary: This applies for all client types.</text>
<text text-anchor="start" x="610.15" y="-5805.4" font-family="Arial" font-size="12.00">For open source projects, secrets can be extracted directly from source code in</text>
<text text-anchor="start" x="620.65" y="-5792.4" font-family="Arial" font-size="12.00">their public repositories. &#160;Secrets can be extracted from application binaries</text>
<text text-anchor="start" x="631.15" y="-5779.4" font-family="Arial" font-size="12.00">just as easily when the published source is not available to the attack[...]</text>
</g>
<!-- Client_Secrets_disclosure&#45;&gt;INTEGRITY -->
<g id="edge6" class="edge">
<title>Client_Secrets_disclosure&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M807.49,-5770.06C753.16,-5710.88 653.67,-5596.3 589.15,-5485 542.04,-5403.75 532.03,-5380.34 510.15,-5289 365.12,-4683.69 262.9,-2613.96 248.75,-2315.08"/>
<polygon fill="black" stroke="black" points="252.24,-2314.64 248.27,-2304.82 245.25,-2314.97 252.24,-2314.64"/>
<text text-anchor="middle" x="540.65" y="-5452.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- Client_Secrets_disclosure_countermeasure0 -->
<g id="node3" class="node">
<title>Client_Secrets_disclosure_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1825.65,-6108 1394.65,-6108 1394.65,-6048 1825.65,-6048 1825.65,-6108"/>
<text text-anchor="start" x="1405.15" y="-6093.4" font-family="Arial" font-weight="bold" font-size="12.00"> Checks on client&#39;s security policy (5_2_3_1_CLIENT_CHECK1) </text>
<text text-anchor="start" x="1418.65" y="-6069.4" font-family="Arial" font-size="12.00"> Don&#39;t issue secrets to public clients or clients with inappropriate</text>
<text text-anchor="start" x="1565.65" y="-6057.4" font-family="Arial" font-size="12.00">security policy </text>
</g>
<!-- Client_Secrets_disclosure_countermeasure0&#45;&gt;Client_Secrets_disclosure -->
<g id="edge1" class="edge">
<title>Client_Secrets_disclosure_countermeasure0&#45;&gt;Client_Secrets_disclosure</title>
<path fill="none" stroke="black" d="M1394.46,-6074.71C1334.89,-6069.02 1270.99,-6058.33 1214.15,-6039 1094.45,-5998.3 973.39,-5912.07 904.87,-5858.1"/>
<polygon fill="black" stroke="black" points="906.78,-5855.15 896.77,-5851.68 902.43,-5860.64 906.78,-5855.15"/>
<text text-anchor="middle" x="1159.65" y="-6034.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- Client_Secrets_disclosure_countermeasure1 -->
<g id="node4" class="node">
<title>Client_Secrets_disclosure_countermeasure1</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1904.15,-6030 1316.15,-6030 1316.15,-5934 1904.15,-5934 1904.15,-6030"/>
<text text-anchor="start" x="1326.15" y="-6015.4" font-family="Arial" font-weight="bold" font-size="12.00"> Require User Consent for Public Clients without Secret (5_2_3_2_USER_CONSENT1) </text>
<text text-anchor="start" x="1390.65" y="-5991.4" font-family="Arial" font-size="12.00"> Authorization servers should not allow automatic authorization for public</text>
<text text-anchor="start" x="1382.15" y="-5979.4" font-family="Arial" font-size="12.00">clients. &#160;The authorization server may issue an individual client id but should</text>
<text text-anchor="start" x="1396.15" y="-5967.4" font-family="Arial" font-size="12.00">require that all authorizations are approved by the end user. &#160;For clients</text>
<text text-anchor="start" x="1393.65" y="-5955.4" font-family="Arial" font-size="12.00">without secrets, this is a countermeasure against the following threat: &#160;&#160;&#45;</text>
<text text-anchor="start" x="1590.15" y="-5943.4" font-family="Arial" font-size="12.00">Im[...] </text>
</g>
<!-- Client_Secrets_disclosure_countermeasure1&#45;&gt;Client_Secrets_disclosure -->
<g id="edge2" class="edge">
<title>Client_Secrets_disclosure_countermeasure1&#45;&gt;Client_Secrets_disclosure</title>
<path fill="none" stroke="black" d="M1315.9,-5944.99C1281.45,-5939.07 1246.92,-5932.42 1214.15,-5925 1132.16,-5906.44 1041.98,-5878.44 971.65,-5854.84"/>
<polygon fill="black" stroke="black" points="972.45,-5851.42 961.86,-5851.54 970.22,-5858.05 972.45,-5851.42"/>
<text text-anchor="middle" x="1159.65" y="-5923.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- Client_Secrets_disclosure_countermeasure2 -->
<g id="node5" class="node">
<title>Client_Secrets_disclosure_countermeasure2</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1951.65,-5916 1268.65,-5916 1268.65,-5820 1951.65,-5820 1951.65,-5916"/>
<text text-anchor="start" x="1279.15" y="-5901.4" font-family="Arial" font-weight="bold" font-size="12.00"> Issue a &quot;client_id&quot; Only in Combination with &quot;redirect_uri&quot; (5_2_3_3_CLIENT_ID_TO_REDIRECT_URI) </text>
<text text-anchor="start" x="1426.65" y="-5877.4" font-family="Arial" font-size="12.00"> The authorization server may issue a &quot;client_id&quot; and bind the</text>
<text text-anchor="start" x="1440.65" y="-5865.4" font-family="Arial" font-size="12.00">&quot;client_id&quot; to a certain pre&#45;configured &quot;redirect_uri&quot;. &#160;Any</text>
<text text-anchor="start" x="1391.65" y="-5853.4" font-family="Arial" font-size="12.00">authorization request with another redirect URI is refused &#160;&#160;automatically.</text>
<text text-anchor="start" x="1373.65" y="-5841.4" font-family="Arial" font-size="12.00">Alternatively, the authorization server should not &#160;&#160;accept any dynamic redirect</text>
<text text-anchor="start" x="1532.15" y="-5829.4" font-family="Arial" font-size="12.00">URI for such a &quot;client_[...] </text>
</g>
<!-- Client_Secrets_disclosure_countermeasure2&#45;&gt;Client_Secrets_disclosure -->
<g id="edge3" class="edge">
<title>Client_Secrets_disclosure_countermeasure2&#45;&gt;Client_Secrets_disclosure</title>
<path fill="none" stroke="black" d="M1268.43,-5842.48C1213.52,-5838.37 1157.5,-5834.17 1104.99,-5830.24"/>
<polygon fill="black" stroke="black" points="1105.12,-5826.74 1094.89,-5829.48 1104.6,-5833.72 1105.12,-5826.74"/>
<text text-anchor="middle" x="1159.65" y="-5839.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- Client_Secrets_disclosure_countermeasure3 -->
<g id="node6" class="node">
<title>Client_Secrets_disclosure_countermeasure3</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1888.65,-5802 1331.65,-5802 1331.65,-5706 1888.65,-5706 1888.65,-5802"/>
<text text-anchor="start" x="1342.15" y="-5787.4" font-family="Arial" font-weight="bold" font-size="12.00"> Issue Installation&#45;Specific Client Secrets (5_2_3_4_SPECIFIC_CLIENT_SECRETS) </text>
<text text-anchor="start" x="1371.15" y="-5763.4" font-family="Arial" font-size="12.00"> An authorization server may issue separate client identifiers and corresponding</text>
<text text-anchor="start" x="1400.65" y="-5751.4" font-family="Arial" font-size="12.00">secrets to the different installations of a particular client (i.e., software</text>
<text text-anchor="start" x="1401.65" y="-5739.4" font-family="Arial" font-size="12.00">package). &#160;The effect of such an approach would be to turn otherwise</text>
<text text-anchor="start" x="1446.65" y="-5727.4" font-family="Arial" font-size="12.00">&quot;public&quot; clients back into &quot;confidential&quot; clients. For web</text>
<text text-anchor="start" x="1539.65" y="-5715.4" font-family="Arial" font-size="12.00">applications, this co[...] </text>
</g>
<!-- Client_Secrets_disclosure_countermeasure3&#45;&gt;Client_Secrets_disclosure -->
<g id="edge4" class="edge">
<title>Client_Secrets_disclosure_countermeasure3&#45;&gt;Client_Secrets_disclosure</title>
<path fill="none" stroke="black" d="M1331.45,-5774.8C1257.42,-5780.34 1177.79,-5786.31 1104.94,-5791.77"/>
<polygon fill="black" stroke="black" points="1104.42,-5788.29 1094.71,-5792.53 1104.94,-5795.28 1104.42,-5788.29"/>
<text text-anchor="middle" x="1159.65" y="-5792.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- Client_Secrets_disclosure_countermeasure4 -->
<g id="node7" class="node">
<title>Client_Secrets_disclosure_countermeasure4</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1871.15,-5688 1349.15,-5688 1349.15,-5592 1871.15,-5592 1871.15,-5688"/>
<text text-anchor="start" x="1359.15" y="-5673.4" font-family="Arial" font-weight="bold" font-size="12.00"> Validate Pre&#45;Registered &quot;redirect_uri&quot; (5_2_3_5_VALIDATE_REDIRECT_URI) </text>
<text text-anchor="start" x="1415.65" y="-5649.4" font-family="Arial" font-size="12.00"> An authorization server should require all clients to register their</text>
<text text-anchor="start" x="1450.15" y="-5637.4" font-family="Arial" font-size="12.00">&quot;redirect_uri&quot;, and the &quot;redirect_uri&quot; should be the full</text>
<text text-anchor="start" x="1375.15" y="-5625.4" font-family="Arial" font-size="12.00">URI as defined in [RFC6749]. &#160;The way that this registration is performed is out</text>
<text text-anchor="start" x="1372.15" y="-5613.4" font-family="Arial" font-size="12.00">of scope of this document. &#160;As per the core spec, every actual redirect URI sent</text>
<text text-anchor="start" x="1541.15" y="-5601.4" font-family="Arial" font-size="12.00">with the respective[...] </text>
</g>
<!-- Client_Secrets_disclosure_countermeasure4&#45;&gt;Client_Secrets_disclosure -->
<g id="edge5" class="edge">
<title>Client_Secrets_disclosure_countermeasure4&#45;&gt;Client_Secrets_disclosure</title>
<path fill="none" stroke="black" d="M1349.11,-5671.53C1303.89,-5678.72 1257.48,-5687.19 1214.15,-5697 1132.16,-5715.56 1041.98,-5743.56 971.65,-5767.16"/>
<polygon fill="black" stroke="black" points="970.22,-5763.95 961.86,-5770.46 972.45,-5770.58 970.22,-5763.95"/>
<text text-anchor="middle" x="1159.65" y="-5720.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_1_EAVESDROPPING_ACCESS_TOKENS1 -->
<g id="node8" class="node">
<title>4_3_1_EAVESDROPPING_ACCESS_TOKENS1</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1067.65,-5475.5 626.65,-5475.5 626.65,-5420.5 1067.65,-5420.5 1067.65,-5475.5"/>
<text text-anchor="start" x="675.65" y="-5460.4" font-family="Arial" font-weight="bold" font-size="12.00">4_3_1_EAVESDROPPING_ACCESS_TOKENS1 ATTACK</text>
<text text-anchor="start" x="1015.65" y="-5460.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="637.15" y="-5442.4" font-family="Arial" font-size="12.00">Attackers may attempt to eavesdrop access tokens in transit from the</text>
<text text-anchor="start" x="747.65" y="-5429.4" font-family="Arial" font-size="12.00">authorization server to the client.</text>
</g>
<!-- 4_3_1_EAVESDROPPING_ACCESS_TOKENS1&#45;&gt;INTEGRITY -->
<g id="edge9" class="edge">
<title>4_3_1_EAVESDROPPING_ACCESS_TOKENS1&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M765.29,-5420.47C708.11,-5397 633.94,-5357.79 589.15,-5300 508.62,-5196.11 534.08,-5144.24 510.15,-5015 307.63,-3921.53 255.82,-2551.59 248.15,-2314.68"/>
<polygon fill="black" stroke="black" points="251.65,-2314.45 247.83,-2304.56 244.65,-2314.67 251.65,-2314.45"/>
<text text-anchor="middle" x="540.65" y="-5273.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_3_1_EAVESDROPPING_ACCESS_TOKENS1_countermeasure0 -->
<g id="node9" class="node">
<title>4_3_1_EAVESDROPPING_ACCESS_TOKENS1_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1915.65,-5574 1304.65,-5574 1304.65,-5502 1915.65,-5502 1915.65,-5574"/>
<text text-anchor="start" x="1315.15" y="-5559.4" font-family="Arial" font-weight="bold" font-size="12.00"> Secure transport layer to CLient to AUTH_SERVER by TLS (CLIENT_AUTH_SERVER_TLS) </text>
<text text-anchor="start" x="1376.65" y="-5535.4" font-family="Arial" font-size="12.00"> As per the core OAuth spec, the authorization servers must ensure that these</text>
<text text-anchor="start" x="1371.15" y="-5523.4" font-family="Arial" font-size="12.00">transmissions are protected using transport&#45;layer mechanisms such as TLS (see</text>
<text text-anchor="start" x="1565.15" y="-5511.4" font-family="Arial" font-size="12.00">Section 5.1.1). </text>
</g>
<!-- 4_3_1_EAVESDROPPING_ACCESS_TOKENS1_countermeasure0&#45;&gt;4_3_1_EAVESDROPPING_ACCESS_TOKENS1 -->
<g id="edge7" class="edge">
<title>4_3_1_EAVESDROPPING_ACCESS_TOKENS1_countermeasure0&#45;&gt;4_3_1_EAVESDROPPING_ACCESS_TOKENS1</title>
<path fill="none" stroke="black" d="M1304.51,-5503.57C1273.98,-5500.04 1243.45,-5496.47 1214.15,-5493 1170.11,-5487.78 1123.11,-5482.1 1077.98,-5476.58"/>
<polygon fill="black" stroke="black" points="1078.13,-5473.07 1067.77,-5475.33 1077.27,-5480.02 1078.13,-5473.07"/>
<text text-anchor="middle" x="1159.65" y="-5493.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_1_EAVESDROPPING_ACCESS_TOKENS1_countermeasure1 -->
<g id="node10" class="node">
<title>4_3_1_EAVESDROPPING_ACCESS_TOKENS1_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="2001.65,-5484 1218.65,-5484 1218.65,-5412 2001.65,-5412 2001.65,-5484"/>
<text text-anchor="start" x="1229.15" y="-5469.4" font-family="Arial" font-weight="bold" font-size="12.00"> Limiting the scope of access tokens obtained through automated approvals (REDUCED_ACCESS_TOKEN_SCOPE) </text>
<text text-anchor="start" x="1398.15" y="-5445.4" font-family="Arial" font-size="12.00"> Authorization servers can mitigate the risks associated with automatic</text>
<text text-anchor="start" x="1374.65" y="-5433.4" font-family="Arial" font-size="12.00">processing by limiting the scope of access tokens obtained through automated</text>
<text text-anchor="start" x="1526.65" y="-5421.4" font-family="Arial" font-size="12.00">approvals (Section 5.1.5.1). </text>
</g>
<!-- 4_3_1_EAVESDROPPING_ACCESS_TOKENS1_countermeasure1&#45;&gt;4_3_1_EAVESDROPPING_ACCESS_TOKENS1 -->
<g id="edge8" class="edge">
<title>4_3_1_EAVESDROPPING_ACCESS_TOKENS1_countermeasure1&#45;&gt;4_3_1_EAVESDROPPING_ACCESS_TOKENS1</title>
<path fill="none" stroke="black" d="M1218.61,-5448C1170.44,-5448 1122.47,-5448 1077.82,-5448"/>
<polygon fill="black" stroke="black" points="1077.74,-5444.5 1067.74,-5448 1077.74,-5451.5 1077.74,-5444.5"/>
<text text-anchor="middle" x="1159.65" y="-5451.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_2_AS_DB_TOKEN_DISCLOSURE -->
<g id="node11" class="node">
<title>4_3_2_AS_DB_TOKEN_DISCLOSURE</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1105.15,-5290.5 589.15,-5290.5 589.15,-5209.5 1105.15,-5209.5 1105.15,-5290.5"/>
<text text-anchor="start" x="702.15" y="-5275.4" font-family="Arial" font-weight="bold" font-size="12.00">4_3_2_AS_DB_TOKEN_DISCLOSURE ATTACK</text>
<text text-anchor="start" x="988.15" y="-5275.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="599.15" y="-5257.4" font-family="Arial" font-size="12.00">An attacker may obtain access tokens from the authorization server’s database by</text>
<text text-anchor="start" x="610.15" y="-5244.4" font-family="Arial" font-size="12.00">gaining access to the database or launching a SQL injection attack. &#160;This threat</text>
<text text-anchor="start" x="620.15" y="-5231.4" font-family="Arial" font-size="12.00">is applicable if the authorization server stores access tokens as handles in a</text>
<text text-anchor="start" x="817.15" y="-5218.4" font-family="Arial" font-size="12.00">database.</text>
</g>
<!-- 4_3_2_AS_DB_TOKEN_DISCLOSURE&#45;&gt;INTEGRITY -->
<g id="edge13" class="edge">
<title>4_3_2_AS_DB_TOKEN_DISCLOSURE&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M780.84,-5209.33C722.66,-5169.92 639.22,-5105.06 589.15,-5029 524.61,-4930.96 533.97,-4891.93 510.15,-4777 304.88,-3786.56 255.61,-2540.2 248.17,-2314.77"/>
<polygon fill="black" stroke="black" points="251.66,-2314.4 247.83,-2304.52 244.66,-2314.63 251.66,-2314.4"/>
<text text-anchor="middle" x="540.65" y="-4999.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure0 -->
<g id="node12" class="node">
<title>4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1908.15,-5394 1312.15,-5394 1312.15,-5346 1908.15,-5346 1908.15,-5394"/>
<text text-anchor="start" x="1322.15" y="-5379.4" font-family="Arial" font-weight="bold" font-size="12.00"> Store access token hashes only (Section 5.1.4.1.3). (5_1_4_1_3_HASHED_TOKEN_DB) </text>
<text text-anchor="start" x="1453.65" y="-5355.4" font-family="Arial" font-size="12.00"> Store access token hashes only (Section 5.1.4.1.3). </text>
</g>
<!-- 4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure0&#45;&gt;4_3_2_AS_DB_TOKEN_DISCLOSURE -->
<g id="edge10" class="edge">
<title>4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure0&#45;&gt;4_3_2_AS_DB_TOKEN_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1312,-5350.01C1278.9,-5346.35 1245.75,-5342.05 1214.15,-5337 1145.29,-5326 1070.2,-5309.05 1006.06,-5293.01"/>
<polygon fill="black" stroke="black" points="1006.82,-5289.6 996.27,-5290.55 1005.12,-5296.38 1006.82,-5289.6"/>
<text text-anchor="middle" x="1159.65" y="-5336.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure1 -->
<g id="node13" class="node">
<title>4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1850.15,-5328 1370.15,-5328 1370.15,-5268 1850.15,-5268 1850.15,-5328"/>
<text text-anchor="start" x="1391.65" y="-5313.4" font-family="Arial" font-weight="bold" font-size="12.00"> Enforce Standard System Security Means (5_1_4_1_1_SYS_SEC) </text>
<text text-anchor="start" x="1380.15" y="-5289.4" font-family="Arial" font-size="12.00"> A server system may be locked down so that no attacker may get access to</text>
<text text-anchor="start" x="1479.15" y="-5277.4" font-family="Arial" font-size="12.00">sensitive configuration files and databases. </text>
</g>
<!-- 4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure1&#45;&gt;4_3_2_AS_DB_TOKEN_DISCLOSURE -->
<g id="edge11" class="edge">
<title>4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure1&#45;&gt;4_3_2_AS_DB_TOKEN_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1369.93,-5282.91C1289.11,-5277.81 1198.37,-5272.09 1115.52,-5266.86"/>
<polygon fill="black" stroke="black" points="1115.65,-5263.37 1105.45,-5266.23 1115.21,-5270.35 1115.65,-5263.37"/>
<text text-anchor="middle" x="1159.65" y="-5274.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure2 -->
<g id="node14" class="node">
<title>4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure2</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1866.15,-5250 1354.15,-5250 1354.15,-5154 1866.15,-5154 1866.15,-5250"/>
<text text-anchor="start" x="1364.15" y="-5235.4" font-family="Arial" font-weight="bold" font-size="12.00"> Enforce Standard SQL Injection Countermeasures (5_1_4_1_2_SQL_SEC) </text>
<text text-anchor="start" x="1372.65" y="-5211.4" font-family="Arial" font-size="12.00"> If a client identifier or other authentication component is queried or compared</text>
<text text-anchor="start" x="1370.15" y="-5199.4" font-family="Arial" font-size="12.00">against a SQL database, it may become possible for an injection attack to occur</text>
<text text-anchor="start" x="1381.65" y="-5187.4" font-family="Arial" font-size="12.00">if parameters received are not validated before submission to the database.</text>
<text text-anchor="start" x="1388.65" y="-5175.4" font-family="Arial" font-size="12.00">&lt;br/&gt;o Ensure that server code is using the minimum database privileges</text>
<text text-anchor="start" x="1597.65" y="-5163.4" font-family="Arial" font-size="12.00">[...] </text>
</g>
<!-- 4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure2&#45;&gt;4_3_2_AS_DB_TOKEN_DISCLOSURE -->
<g id="edge12" class="edge">
<title>4_3_2_AS_DB_TOKEN_DISCLOSURE_countermeasure2&#45;&gt;4_3_2_AS_DB_TOKEN_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1353.89,-5218.1C1277.33,-5222.93 1193.15,-5228.24 1115.8,-5233.12"/>
<polygon fill="black" stroke="black" points="1115.19,-5229.65 1105.43,-5233.77 1115.63,-5236.64 1115.19,-5229.65"/>
<text text-anchor="middle" x="1159.65" y="-5234.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_3_CLIENT_CREDENTIALS_DISCLOSURE -->
<g id="node15" class="node">
<title>4_3_3_CLIENT_CREDENTIALS_DISCLOSURE</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1096.65,-5020 597.65,-5020 597.65,-4952 1096.65,-4952 1096.65,-5020"/>
<text text-anchor="start" x="677.15" y="-5005.4" font-family="Arial" font-weight="bold" font-size="12.00">4_3_3_CLIENT_CREDENTIALS_DISCLOSURE ATTACK</text>
<text text-anchor="start" x="1014.15" y="-5005.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="616.15" y="-4987.4" font-family="Arial" font-size="12.00">An attacker could attempt to eavesdrop the transmission of client credentials</text>
<text text-anchor="start" x="608.15" y="-4974.4" font-family="Arial" font-size="12.00">between the client and server during the client authentication process or during</text>
<text text-anchor="start" x="781.15" y="-4961.4" font-family="Arial" font-size="12.00">OAuth token requests.</text>
</g>
<!-- 4_3_3_CLIENT_CREDENTIALS_DISCLOSURE&#45;&gt;INTEGRITY -->
<g id="edge16" class="edge">
<title>4_3_3_CLIENT_CREDENTIALS_DISCLOSURE&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M778.77,-4952C719.6,-4918.59 635.87,-4862.05 589.15,-4789 502.98,-4654.3 537.41,-4595.56 510.15,-4438 362.08,-3582.2 267.71,-2521.36 250.08,-2314.78"/>
<polygon fill="black" stroke="black" points="253.54,-2314.18 249.21,-2304.52 246.57,-2314.78 253.54,-2314.18"/>
<text text-anchor="middle" x="540.65" y="-4761.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_3_3_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure0 -->
<g id="node16" class="node">
<title>4_3_3_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1879.65,-5136 1340.65,-5136 1340.65,-5040 1879.65,-5040 1879.65,-5136"/>
<text text-anchor="start" x="1351.15" y="-5121.4" font-family="Arial" font-weight="bold" font-size="12.00"> Ensure Confidentiality of Requests (TLS) (5_1_1_CONFIDENTIAL_REQUESTS) </text>
<text text-anchor="start" x="1392.65" y="-5097.4" font-family="Arial" font-size="12.00"> This is applicable to all requests sent from the client to the authorization</text>
<text text-anchor="start" x="1375.65" y="-5085.4" font-family="Arial" font-size="12.00">server or resource server. While OAuth provides a mechanism for verifying the</text>
<text text-anchor="start" x="1396.15" y="-5073.4" font-family="Arial" font-size="12.00">integrity of requests, it provides no guarantee of request confidentiality.</text>
<text text-anchor="start" x="1384.15" y="-5061.4" font-family="Arial" font-size="12.00">Unless further precautions are taken, eavesdroppers will have full access to</text>
<text text-anchor="start" x="1598.15" y="-5049.4" font-family="Arial" font-size="12.00">[...] </text>
</g>
<!-- 4_3_3_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure0&#45;&gt;4_3_3_CLIENT_CREDENTIALS_DISCLOSURE -->
<g id="edge14" class="edge">
<title>4_3_3_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure0&#45;&gt;4_3_3_CLIENT_CREDENTIALS_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1340.58,-5052C1264.63,-5041.82 1182.14,-5030.77 1106.78,-5020.67"/>
<polygon fill="black" stroke="black" points="1107.06,-5017.17 1096.68,-5019.31 1106.13,-5024.11 1107.06,-5017.17"/>
<text text-anchor="middle" x="1159.65" y="-5033.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_3_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure1 -->
<g id="node17" class="node">
<title>4_3_3_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1883.15,-5022 1337.15,-5022 1337.15,-4950 1883.15,-4950 1883.15,-5022"/>
<text text-anchor="start" x="1347.15" y="-5007.4" font-family="Arial" font-weight="bold" font-size="12.00"> Do not send plaintext credentials (CONFIDENTIAL_CREDENTIALS_REQUESTS) </text>
<text text-anchor="start" x="1393.65" y="-4983.4" font-family="Arial" font-size="12.00"> Use alternative authentication means that do not require the sending of</text>
<text text-anchor="start" x="1380.15" y="-4971.4" font-family="Arial" font-size="12.00">plaintext credentials over the wire (e.g., Hash&#45;based Message Authentication</text>
<text text-anchor="start" x="1588.65" y="-4959.4" font-family="Arial" font-size="12.00">Code). </text>
</g>
<!-- 4_3_3_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure1&#45;&gt;4_3_3_CLIENT_CREDENTIALS_DISCLOSURE -->
<g id="edge15" class="edge">
<title>4_3_3_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure1&#45;&gt;4_3_3_CLIENT_CREDENTIALS_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1337.09,-4986C1262.22,-4986 1181.22,-4986 1107.11,-4986"/>
<polygon fill="black" stroke="black" points="1106.69,-4982.5 1096.69,-4986 1106.69,-4989.5 1106.69,-4982.5"/>
<text text-anchor="middle" x="1159.65" y="-4989.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_4_CLIENT_CREDENTIALS_DISCLOSURE -->
<g id="node18" class="node">
<title>4_3_4_CLIENT_CREDENTIALS_DISCLOSURE</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1100.65,-4780 593.65,-4780 593.65,-4712 1100.65,-4712 1100.65,-4780"/>
<text text-anchor="start" x="677.15" y="-4765.4" font-family="Arial" font-weight="bold" font-size="12.00">4_3_4_CLIENT_CREDENTIALS_DISCLOSURE ATTACK</text>
<text text-anchor="start" x="1014.15" y="-4765.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="639.65" y="-4747.4" font-family="Arial" font-size="12.00">An attacker may obtain valid &quot;client_id&quot;/secret combinations from the</text>
<text text-anchor="start" x="604.15" y="-4734.4" font-family="Arial" font-size="12.00">authorization server’s database by gaining access to the database or launching a</text>
<text text-anchor="start" x="785.65" y="-4721.4" font-family="Arial" font-size="12.00">SQL injection attack.</text>
</g>
<!-- 4_3_4_CLIENT_CREDENTIALS_DISCLOSURE&#45;&gt;INTEGRITY -->
<g id="edge20" class="edge">
<title>4_3_4_CLIENT_CREDENTIALS_DISCLOSURE&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M798.73,-4711.84C739.15,-4666.1 638.73,-4579.01 589.15,-4479 387.93,-4073.16 268.42,-2566.31 249.67,-2314.73"/>
<polygon fill="black" stroke="black" points="253.16,-2314.39 248.93,-2304.67 246.18,-2314.9 253.16,-2314.39"/>
<text text-anchor="middle" x="540.65" y="-4422.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure0 -->
<g id="node19" class="node">
<title>4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1866.15,-4932 1354.15,-4932 1354.15,-4836 1866.15,-4836 1866.15,-4932"/>
<text text-anchor="start" x="1364.15" y="-4917.4" font-family="Arial" font-weight="bold" font-size="12.00"> Enforce Standard SQL Injection Countermeasures (5_1_4_1_2_SQL_SEC) </text>
<text text-anchor="start" x="1372.65" y="-4893.4" font-family="Arial" font-size="12.00"> If a client identifier or other authentication component is queried or compared</text>
<text text-anchor="start" x="1370.15" y="-4881.4" font-family="Arial" font-size="12.00">against a SQL database, it may become possible for an injection attack to occur</text>
<text text-anchor="start" x="1381.65" y="-4869.4" font-family="Arial" font-size="12.00">if parameters received are not validated before submission to the database.</text>
<text text-anchor="start" x="1388.65" y="-4857.4" font-family="Arial" font-size="12.00">&lt;br/&gt;o Ensure that server code is using the minimum database privileges</text>
<text text-anchor="start" x="1597.65" y="-4845.4" font-family="Arial" font-size="12.00">[...] </text>
</g>
<!-- 4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure0&#45;&gt;4_3_4_CLIENT_CREDENTIALS_DISCLOSURE -->
<g id="edge17" class="edge">
<title>4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure0&#45;&gt;4_3_4_CLIENT_CREDENTIALS_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1353.98,-4850.02C1307.36,-4843.01 1259.22,-4835.23 1214.15,-4827 1143.51,-4814.11 1065.77,-4797.28 1000.18,-4782.31"/>
<polygon fill="black" stroke="black" points="1000.7,-4778.84 990.17,-4780.02 999.14,-4785.66 1000.7,-4778.84"/>
<text text-anchor="middle" x="1159.65" y="-4826.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure1 -->
<g id="node20" class="node">
<title>4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1850.15,-4818 1370.15,-4818 1370.15,-4758 1850.15,-4758 1850.15,-4818"/>
<text text-anchor="start" x="1391.65" y="-4803.4" font-family="Arial" font-weight="bold" font-size="12.00"> Enforce Standard System Security Means (5_1_4_1_1_SYS_SEC) </text>
<text text-anchor="start" x="1380.15" y="-4779.4" font-family="Arial" font-size="12.00"> A server system may be locked down so that no attacker may get access to</text>
<text text-anchor="start" x="1479.15" y="-4767.4" font-family="Arial" font-size="12.00">sensitive configuration files and databases. </text>
</g>
<!-- 4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure1&#45;&gt;4_3_4_CLIENT_CREDENTIALS_DISCLOSURE -->
<g id="edge18" class="edge">
<title>4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure1&#45;&gt;4_3_4_CLIENT_CREDENTIALS_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1369.93,-4774.8C1287.64,-4770.26 1195.08,-4765.15 1111.02,-4760.51"/>
<polygon fill="black" stroke="black" points="1110.99,-4757 1100.81,-4759.94 1110.6,-4763.99 1110.99,-4757"/>
<text text-anchor="middle" x="1159.65" y="-4767.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure2 -->
<g id="node21" class="node">
<title>4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure2</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1905.65,-4740 1314.65,-4740 1314.65,-4668 1905.65,-4668 1905.65,-4740"/>
<text text-anchor="start" x="1325.15" y="-4725.4" font-family="Arial" font-weight="bold" font-size="12.00"> Enforce Credential Storage Protection Best Practices (5_1_4_1_CRED_PROTECTION) </text>
<text text-anchor="start" x="1373.15" y="-4701.4" font-family="Arial" font-size="12.00"> Administrators should undertake industry best practices to protect the storage</text>
<text text-anchor="start" x="1375.15" y="-4689.4" font-family="Arial" font-size="12.00">of credentials (for example, see [OWASP]). Such practices may include but are</text>
<text text-anchor="start" x="1487.65" y="-4677.4" font-family="Arial" font-size="12.00">not limited to the following sub&#45;sections. </text>
</g>
<!-- 4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure2&#45;&gt;4_3_4_CLIENT_CREDENTIALS_DISCLOSURE -->
<g id="edge19" class="edge">
<title>4_3_4_CLIENT_CREDENTIALS_DISCLOSURE_countermeasure2&#45;&gt;4_3_4_CLIENT_CREDENTIALS_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1314.38,-4720.27C1247.28,-4723.97 1176.43,-4727.88 1110.78,-4731.51"/>
<polygon fill="black" stroke="black" points="1110.5,-4728.02 1100.71,-4732.06 1110.89,-4735 1110.5,-4728.02"/>
<text text-anchor="middle" x="1159.65" y="-4732.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_5_CLIENT_SECRET_BRUTE_FORCE -->
<g id="node22" class="node">
<title>4_3_5_CLIENT_SECRET_BRUTE_FORCE</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1030.15,-4470 664.15,-4470 664.15,-4428 1030.15,-4428 1030.15,-4470"/>
<text text-anchor="start" x="692.65" y="-4455.4" font-family="Arial" font-weight="bold" font-size="12.00">4_3_5_CLIENT_SECRET_BRUTE_FORCE ATTACK</text>
<text text-anchor="start" x="997.65" y="-4455.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="674.15" y="-4437.4" font-family="Arial" font-size="12.00">An attacker may try to guess valid &quot;client_id&quot;/secret pairs.</text>
</g>
<!-- 4_3_5_CLIENT_SECRET_BRUTE_FORCE&#45;&gt;INTEGRITY -->
<g id="edge24" class="edge">
<title>4_3_5_CLIENT_SECRET_BRUTE_FORCE&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M830.64,-4427.72C785.86,-4365.2 655.32,-4175.31 589.15,-3998 347.4,-3350.22 265.31,-2498.11 249.9,-2314.72"/>
<polygon fill="black" stroke="black" points="253.38,-2314.24 249.06,-2304.57 246.4,-2314.82 253.38,-2314.24"/>
<text text-anchor="middle" x="540.65" y="-3912.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure0 -->
<g id="node23" class="node">
<title>4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1857.15,-4650 1363.15,-4650 1363.15,-4554 1857.15,-4554 1857.15,-4650"/>
<text text-anchor="start" x="1378.65" y="-4635.4" font-family="Arial" font-weight="bold" font-size="12.00"> Use High Entropy for Secrets (5_1_4_2_2_HIGH_ENTROPY_SECRETS) </text>
<text text-anchor="start" x="1386.15" y="-4611.4" font-family="Arial" font-size="12.00"> When creating secrets not intended for usage by human users (e.g., client</text>
<text text-anchor="start" x="1373.15" y="-4599.4" font-family="Arial" font-size="12.00">secrets or token handles), the authorization server should include a reasonable</text>
<text text-anchor="start" x="1386.15" y="-4587.4" font-family="Arial" font-size="12.00">level of entropy in order to mitigate the risk of guessing attacks. The token</text>
<text text-anchor="start" x="1387.15" y="-4575.4" font-family="Arial" font-size="12.00">value should be &gt;=128 bits long and constructed from a cryptographically</text>
<text text-anchor="start" x="1590.15" y="-4563.4" font-family="Arial" font-size="12.00">str[...] </text>
</g>
<!-- 4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure0&#45;&gt;4_3_5_CLIENT_SECRET_BRUTE_FORCE -->
<g id="edge21" class="edge">
<title>4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure0&#45;&gt;4_3_5_CLIENT_SECRET_BRUTE_FORCE</title>
<path fill="none" stroke="black" d="M1362.93,-4570.87C1313.48,-4563.38 1262.02,-4554.7 1214.15,-4545 1114.79,-4524.87 1002.22,-4494.12 928.47,-4472.88"/>
<polygon fill="black" stroke="black" points="929.36,-4469.49 918.78,-4470.07 927.41,-4476.21 929.36,-4469.49"/>
<text text-anchor="middle" x="1159.65" y="-4543.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure1 -->
<g id="node24" class="node">
<title>4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1865.15,-4536 1355.15,-4536 1355.15,-4464 1865.15,-4464 1865.15,-4536"/>
<text text-anchor="start" x="1456.15" y="-4521.4" font-family="Arial" font-weight="bold" font-size="12.00"> Lock Accounts (5_1_4_2_3_LOCK_ACCOUNTS) </text>
<text text-anchor="start" x="1365.15" y="-4497.4" font-family="Arial" font-size="12.00"> Online attacks on passwords can be mitigated by locking the respective accounts</text>
<text text-anchor="start" x="1371.15" y="-4485.4" font-family="Arial" font-size="12.00">after a certain number of failed attempts. Note: This measure can be abused to</text>
<text text-anchor="start" x="1503.15" y="-4473.4" font-family="Arial" font-size="12.00">lock down legitimate service users. </text>
</g>
<!-- 4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure1&#45;&gt;4_3_5_CLIENT_SECRET_BRUTE_FORCE -->
<g id="edge22" class="edge">
<title>4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure1&#45;&gt;4_3_5_CLIENT_SECRET_BRUTE_FORCE</title>
<path fill="none" stroke="black" d="M1354.95,-4482.96C1252.27,-4476.08 1135.76,-4468.27 1040.35,-4461.88"/>
<polygon fill="black" stroke="black" points="1040.52,-4458.38 1030.3,-4461.21 1040.05,-4465.37 1040.52,-4458.38"/>
<text text-anchor="middle" x="1159.65" y="-4474.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure2 -->
<g id="node25" class="node">
<title>4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure2</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1886.65,-4446 1333.65,-4446 1333.65,-4350 1886.65,-4350 1886.65,-4446"/>
<text text-anchor="start" x="1344.15" y="-4431.4" font-family="Arial" font-weight="bold" font-size="12.00"> Use strong client authentication (5_2_3_7_STRONG_CLIENT_AUTHENTICATION) </text>
<text text-anchor="start" x="1374.65" y="-4407.4" font-family="Arial" font-size="12.00"> By using an alternative form of authentication such as client assertion [OAuth&#45;</text>
<text text-anchor="start" x="1410.15" y="-4395.4" font-family="Arial" font-size="12.00">ASSERTIONS], the need to distribute a &quot;client_secret&quot; is eliminated.</text>
<text text-anchor="start" x="1380.65" y="-4383.4" font-family="Arial" font-size="12.00">This may require the use of a secure private key store or other supplemental</text>
<text text-anchor="start" x="1403.65" y="-4371.4" font-family="Arial" font-size="12.00">authentication system as specified by the client assertion issuer in its</text>
<text text-anchor="start" x="1566.65" y="-4359.4" font-family="Arial" font-size="12.00">authentica[...] </text>
</g>
<!-- 4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure2&#45;&gt;4_3_5_CLIENT_SECRET_BRUTE_FORCE -->
<g id="edge23" class="edge">
<title>4_3_5_CLIENT_SECRET_BRUTE_FORCE_countermeasure2&#45;&gt;4_3_5_CLIENT_SECRET_BRUTE_FORCE</title>
<path fill="none" stroke="black" d="M1333.6,-4416.47C1236.41,-4422.98 1129.3,-4430.16 1040.48,-4436.11"/>
<polygon fill="black" stroke="black" points="1040.04,-4432.63 1030.29,-4436.79 1040.5,-4439.62 1040.04,-4432.63"/>
<text text-anchor="middle" x="1159.65" y="-4432.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE -->
<g id="node26" class="node">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1072.15,-3989 622.15,-3989 622.15,-3895 1072.15,-3895 1072.15,-3989"/>
<text text-anchor="start" x="702.15" y="-3974.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_1_1_AUTH_CODE_DISCLOSURE ATTACK</text>
<text text-anchor="start" x="988.15" y="-3974.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="642.65" y="-3956.4" font-family="Arial" font-size="12.00">An attacker could try to eavesdrop transmission of the authorization</text>
<text text-anchor="start" x="651.65" y="-3943.4" font-family="Arial" font-size="12.00">&quot;code&quot; between the authorization server and client. Furthermore,</text>
<text text-anchor="start" x="664.15" y="-3930.4" font-family="Arial" font-size="12.00">authorization &quot;codes&quot; are passed via the browser, which may</text>
<text text-anchor="start" x="632.15" y="-3917.4" font-family="Arial" font-size="12.00">unintentionally leak those codes to untrusted web sites and attackers in</text>
<text text-anchor="start" x="713.15" y="-3904.4" font-family="Arial" font-size="12.00">different ways: &lt;br/&gt;o Referrer headers: [...]</text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE&#45;&gt;INTEGRITY -->
<g id="edge31" class="edge">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M803.05,-3894.86C746.08,-3830.13 646.25,-3707.92 589.15,-3587 365.5,-3113.44 271.85,-2471.75 251.48,-2314.75"/>
<polygon fill="black" stroke="black" points="254.94,-2314.17 250.2,-2304.7 248,-2315.06 254.94,-2314.17"/>
<text text-anchor="middle" x="540.65" y="-3523.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure0 -->
<g id="node27" class="node">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1879.65,-4332 1340.65,-4332 1340.65,-4236 1879.65,-4236 1879.65,-4332"/>
<text text-anchor="start" x="1351.15" y="-4317.4" font-family="Arial" font-weight="bold" font-size="12.00"> Ensure Confidentiality of Requests (TLS) (5_1_1_CONFIDENTIAL_REQUESTS) </text>
<text text-anchor="start" x="1392.65" y="-4293.4" font-family="Arial" font-size="12.00"> This is applicable to all requests sent from the client to the authorization</text>
<text text-anchor="start" x="1375.65" y="-4281.4" font-family="Arial" font-size="12.00">server or resource server. While OAuth provides a mechanism for verifying the</text>
<text text-anchor="start" x="1396.15" y="-4269.4" font-family="Arial" font-size="12.00">integrity of requests, it provides no guarantee of request confidentiality.</text>
<text text-anchor="start" x="1384.15" y="-4257.4" font-family="Arial" font-size="12.00">Unless further precautions are taken, eavesdroppers will have full access to</text>
<text text-anchor="start" x="1598.15" y="-4245.4" font-family="Arial" font-size="12.00">[...] </text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure0&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE -->
<g id="edge25" class="edge">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure0&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1340.53,-4264.4C1297.22,-4255.85 1253.67,-4243.83 1214.15,-4227 1086.79,-4172.78 965.46,-4062.9 899.48,-3996.54"/>
<polygon fill="black" stroke="black" points="901.62,-3993.72 892.1,-3989.06 896.64,-3998.64 901.62,-3993.72"/>
<text text-anchor="middle" x="1159.65" y="-4219.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure1 -->
<g id="node28" class="node">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure1</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1900.65,-4218 1319.65,-4218 1319.65,-4122 1900.65,-4122 1900.65,-4218"/>
<text text-anchor="start" x="1330.15" y="-4203.4" font-family="Arial" font-weight="bold" font-size="12.00"> Binding of Authorization &quot;code&quot; to &quot;client_id&quot; (5_2_4_4_CLIENT_TO_CODE_BINDING) </text>
<text text-anchor="start" x="1397.65" y="-4179.4" font-family="Arial" font-size="12.00"> The authorization server should bind every authorization &quot;code&quot; to the</text>
<text text-anchor="start" x="1387.15" y="-4167.4" font-family="Arial" font-size="12.00">id of the respective client that initiated the end&#45;user authorization process.</text>
<text text-anchor="start" x="1387.15" y="-4155.4" font-family="Arial" font-size="12.00">This measure is a countermeasure against: &lt;br/&gt;o Replay of authorization</text>
<text text-anchor="start" x="1415.65" y="-4143.4" font-family="Arial" font-size="12.00">&quot;codes&quot; with different client credentials, since an attacker cannot</text>
<text text-anchor="start" x="1547.65" y="-4131.4" font-family="Arial" font-size="12.00">use another &quot;clie[...] </text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure1&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE -->
<g id="edge26" class="edge">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure1&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1319.54,-4138.24C1283.7,-4131.37 1247.84,-4123.06 1214.15,-4113 1116.51,-4083.84 1011.81,-4032.7 939.52,-3993.93"/>
<polygon fill="black" stroke="black" points="940.88,-3990.69 930.42,-3989.02 937.56,-3996.85 940.88,-3990.69"/>
<text text-anchor="middle" x="1159.65" y="-4109.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure2 -->
<g id="node29" class="node">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure2</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1832.65,-4104 1387.65,-4104 1387.65,-4008 1832.65,-4008 1832.65,-4104"/>
<text text-anchor="start" x="1409.15" y="-4089.4" font-family="Arial" font-weight="bold" font-size="12.00"> Use Short Expiration Time (5_1_5_3_SHORT_EXPIRY_CODE) </text>
<text text-anchor="start" x="1398.15" y="-4065.4" font-family="Arial" font-size="12.00"> A short expiration time for tokens is a means of protection against the</text>
<text text-anchor="start" x="1433.15" y="-4053.4" font-family="Arial" font-size="12.00">following threats: &lt;br/&gt;o replay &lt;br/&gt;o token leak (a short</text>
<text text-anchor="start" x="1409.65" y="-4041.4" font-family="Arial" font-size="12.00">expiration time will reduce impact) &lt;br/&gt;o online guessing (a short</text>
<text text-anchor="start" x="1399.65" y="-4029.4" font-family="Arial" font-size="12.00">expiration time will reduce the likelihood of success) Note: Short token</text>
<text text-anchor="start" x="1492.65" y="-4017.4" font-family="Arial" font-size="12.00">duration requires more precise cloc[...] </text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure2&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE -->
<g id="edge27" class="edge">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure2&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1387.63,-4024.48C1331.05,-4016.31 1270.33,-4007.43 1214.15,-3999 1171.58,-3992.61 1126.25,-3985.67 1082.51,-3978.9"/>
<polygon fill="black" stroke="black" points="1083.03,-3975.44 1072.61,-3977.36 1081.96,-3982.35 1083.03,-3975.44"/>
<text text-anchor="middle" x="1159.65" y="-3999.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure3 -->
<g id="node30" class="node">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure3</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1885.15,-3990 1335.15,-3990 1335.15,-3894 1885.15,-3894 1885.15,-3990"/>
<text text-anchor="start" x="1345.15" y="-3975.4" font-family="Arial" font-weight="bold" font-size="12.00"> Limit Number of Usages or One&#45;Time Usage (5_1_5_4_ONE_TIME_USE_TOKEN) </text>
<text text-anchor="start" x="1368.15" y="-3951.4" font-family="Arial" font-size="12.00"> The authorization server may restrict the number of requests or operations that</text>
<text text-anchor="start" x="1369.15" y="-3939.4" font-family="Arial" font-size="12.00">can be performed with a certain token. This mechanism can be used to mitigate</text>
<text text-anchor="start" x="1410.15" y="-3927.4" font-family="Arial" font-size="12.00">the following threats: &lt;br/&gt;o replay of tokens &lt;br/&gt;o guessing For</text>
<text text-anchor="start" x="1361.65" y="-3915.4" font-family="Arial" font-size="12.00">example, if an authorization server observes more than one attempt to redeem an</text>
<text text-anchor="start" x="1588.15" y="-3903.4" font-family="Arial" font-size="12.00">aut[...] </text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure3&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE -->
<g id="edge28" class="edge">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure3&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1334.95,-3942C1252.23,-3942 1162.23,-3942 1082.37,-3942"/>
<polygon fill="black" stroke="black" points="1082.18,-3938.5 1072.18,-3942 1082.18,-3945.5 1082.18,-3938.5"/>
<text text-anchor="middle" x="1159.65" y="-3945.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure4 -->
<g id="node31" class="node">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure4</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1958.15,-3876 1262.15,-3876 1262.15,-3804 1958.15,-3804 1958.15,-3876"/>
<text text-anchor="start" x="1272.15" y="-3861.4" font-family="Arial" font-weight="bold" font-size="12.00"> Automatic Revocation of Derived Tokens If Abuse Is Detected (5_2_1_1_TOKEN_ABUSE_DETECTION) </text>
<text text-anchor="start" x="1365.15" y="-3837.4" font-family="Arial" font-size="12.00"> If an authorization server observes multiple attempts to redeem an authorization</text>
<text text-anchor="start" x="1422.65" y="-3825.4" font-family="Arial" font-size="12.00">grant (e.g., such as an authorization &quot;code&quot;), the authorization</text>
<text text-anchor="start" x="1371.15" y="-3813.4" font-family="Arial" font-size="12.00">server may want to revoke all tokens granted based on the authorization grant </text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure4&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE -->
<g id="edge29" class="edge">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure4&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1283.53,-3876.02C1260.04,-3878.95 1236.72,-3881.96 1214.15,-3885 1171.49,-3890.75 1126.11,-3897.39 1082.36,-3904.06"/>
<polygon fill="black" stroke="black" points="1081.82,-3900.6 1072.46,-3905.57 1082.88,-3907.52 1081.82,-3900.6"/>
<text text-anchor="middle" x="1159.65" y="-3900.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure5 -->
<g id="node32" class="node">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure5</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1846.15,-3786 1374.15,-3786 1374.15,-3726 1846.15,-3726 1846.15,-3786"/>
<text text-anchor="start" x="1425.65" y="-3771.4" font-family="Arial" font-weight="bold" font-size="12.00"> Reload the target page (USER_AGENT_PAGE_RELOAD) </text>
<text text-anchor="start" x="1384.15" y="-3747.4" font-family="Arial" font-size="12.00"> The client server may reload the target page of the redirect URI in order to</text>
<text text-anchor="start" x="1480.65" y="-3735.4" font-family="Arial" font-size="12.00">automatically clean up the browser cache. </text>
</g>
<!-- 4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure5&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE -->
<g id="edge30" class="edge">
<title>4_4_1_1_AUTH_CODE_DISCLOSURE_countermeasure5&#45;&gt;4_4_1_1_AUTH_CODE_DISCLOSURE</title>
<path fill="none" stroke="black" d="M1374.14,-3768.17C1321.04,-3773.96 1265.27,-3782.48 1214.15,-3795 1123.12,-3817.29 1024.82,-3857.76 953.04,-3890.6"/>
<polygon fill="black" stroke="black" points="951.15,-3887.61 943.53,-3894.98 954.08,-3893.97 951.15,-3887.61"/>
<text text-anchor="middle" x="1159.65" y="-3822.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_2_AUTH_CODE_DISCLOSURE_DB -->
<g id="node33" class="node">
<title>4_4_1_2_AUTH_CODE_DISCLOSURE_DB</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1070.65,-3577.5 623.65,-3577.5 623.65,-3496.5 1070.65,-3496.5 1070.65,-3577.5"/>
<text text-anchor="start" x="690.65" y="-3562.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_1_2_AUTH_CODE_DISCLOSURE_DB ATTACK</text>
<text text-anchor="start" x="1000.65" y="-3562.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="634.15" y="-3544.4" font-family="Arial" font-size="12.00">This threat is applicable if the authorization server stores &#160;authorization</text>
<text text-anchor="start" x="672.15" y="-3531.4" font-family="Arial" font-size="12.00">&quot;codes&quot; as handles in a database. An attacker may &#160;obtain</text>
<text text-anchor="start" x="647.65" y="-3518.4" font-family="Arial" font-size="12.00">authorization &quot;codes&quot; from the authorization server’s database &#160;by</text>
<text text-anchor="start" x="644.65" y="-3505.4" font-family="Arial" font-size="12.00">gaining access to the database or launching a SQL injection &#160;attack.</text>
</g>
<!-- 4_4_1_2_AUTH_CODE_DISCLOSURE_DB&#45;&gt;INTEGRITY -->
<g id="edge35" class="edge">
<title>4_4_1_2_AUTH_CODE_DISCLOSURE_DB&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M810.8,-3496.25C757.24,-3432.94 654.82,-3305.55 589.15,-3184 416.36,-2864.18 291.25,-2438.33 256.69,-2314.28"/>
<polygon fill="black" stroke="black" points="260.03,-2313.25 253.99,-2304.54 253.29,-2315.12 260.03,-2313.25"/>
<text text-anchor="middle" x="540.65" y="-3140.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure0 -->
<g id="node34" class="node">
<title>4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1850.15,-3708 1370.15,-3708 1370.15,-3648 1850.15,-3648 1850.15,-3708"/>
<text text-anchor="start" x="1391.65" y="-3693.4" font-family="Arial" font-weight="bold" font-size="12.00"> Enforce Standard System Security Means (5_1_4_1_1_SYS_SEC) </text>
<text text-anchor="start" x="1380.15" y="-3669.4" font-family="Arial" font-size="12.00"> A server system may be locked down so that no attacker may get access to</text>
<text text-anchor="start" x="1479.15" y="-3657.4" font-family="Arial" font-size="12.00">sensitive configuration files and databases. </text>
</g>
<!-- 4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure0&#45;&gt;4_4_1_2_AUTH_CODE_DISCLOSURE_DB -->
<g id="edge32" class="edge">
<title>4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure0&#45;&gt;4_4_1_2_AUTH_CODE_DISCLOSURE_DB</title>
<path fill="none" stroke="black" d="M1370.08,-3661.12C1318.42,-3655.6 1264.27,-3648.39 1214.15,-3639 1136.59,-3624.48 1051.6,-3601.26 983.06,-3580.64"/>
<polygon fill="black" stroke="black" points="983.66,-3577.16 973.07,-3577.62 981.63,-3583.86 983.66,-3577.16"/>
<text text-anchor="middle" x="1159.65" y="-3638.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure1 -->
<g id="node35" class="node">
<title>4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1866.15,-3630 1354.15,-3630 1354.15,-3534 1866.15,-3534 1866.15,-3630"/>
<text text-anchor="start" x="1364.15" y="-3615.4" font-family="Arial" font-weight="bold" font-size="12.00"> Enforce Standard SQL Injection Countermeasures (5_1_4_1_2_SQL_SEC) </text>
<text text-anchor="start" x="1372.65" y="-3591.4" font-family="Arial" font-size="12.00"> If a client identifier or other authentication component is queried or compared</text>
<text text-anchor="start" x="1370.15" y="-3579.4" font-family="Arial" font-size="12.00">against a SQL database, it may become possible for an injection attack to occur</text>
<text text-anchor="start" x="1381.65" y="-3567.4" font-family="Arial" font-size="12.00">if parameters received are not validated before submission to the database.</text>
<text text-anchor="start" x="1388.65" y="-3555.4" font-family="Arial" font-size="12.00">&lt;br/&gt;o Ensure that server code is using the minimum database privileges</text>
<text text-anchor="start" x="1597.65" y="-3543.4" font-family="Arial" font-size="12.00">[...] </text>
</g>
<!-- 4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure1&#45;&gt;4_4_1_2_AUTH_CODE_DISCLOSURE_DB -->
<g id="edge33" class="edge">
<title>4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure1&#45;&gt;4_4_1_2_AUTH_CODE_DISCLOSURE_DB</title>
<path fill="none" stroke="black" d="M1353.89,-3566.91C1265.72,-3561.69 1167.45,-3555.88 1081.15,-3550.78"/>
<polygon fill="black" stroke="black" points="1081.15,-3547.27 1070.96,-3550.18 1080.73,-3554.26 1081.15,-3547.27"/>
<text text-anchor="middle" x="1159.65" y="-3559.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure2 -->
<g id="node36" class="node">
<title>4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure2</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1908.15,-3516 1312.15,-3516 1312.15,-3468 1908.15,-3468 1908.15,-3516"/>
<text text-anchor="start" x="1322.15" y="-3501.4" font-family="Arial" font-weight="bold" font-size="12.00"> Store access token hashes only (Section 5.1.4.1.3). (5_1_4_1_3_HASHED_TOKEN_DB) </text>
<text text-anchor="start" x="1453.65" y="-3477.4" font-family="Arial" font-size="12.00"> Store access token hashes only (Section 5.1.4.1.3). </text>
</g>
<!-- 4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure2&#45;&gt;4_4_1_2_AUTH_CODE_DISCLOSURE_DB -->
<g id="edge34" class="edge">
<title>4_4_1_2_AUTH_CODE_DISCLOSURE_DB_countermeasure2&#45;&gt;4_4_1_2_AUTH_CODE_DISCLOSURE_DB</title>
<path fill="none" stroke="black" d="M1311.93,-3509.58C1235.26,-3514.11 1153.86,-3518.92 1081,-3523.23"/>
<polygon fill="black" stroke="black" points="1080.55,-3519.75 1070.77,-3523.84 1080.96,-3526.74 1080.55,-3519.75"/>
<text text-anchor="middle" x="1159.65" y="-3522.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE -->
<g id="node37" class="node">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1061.65,-3175 632.65,-3175 632.65,-3107 1061.65,-3107 1061.65,-3175"/>
<text text-anchor="start" x="698.15" y="-3160.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_1_3_AUTH_CODE_BRUTE_FORCE ATTACK</text>
<text text-anchor="start" x="993.15" y="-3160.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="647.65" y="-3142.4" font-family="Arial" font-size="12.00">An attacker may try to guess valid authorization &quot;code&quot; values and</text>
<text text-anchor="start" x="643.15" y="-3129.4" font-family="Arial" font-size="12.00">send the guessed code value using the grant type &quot;code&quot; in order to</text>
<text text-anchor="start" x="764.65" y="-3116.4" font-family="Arial" font-size="12.00">obtain a valid access token.</text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE&#45;&gt;INTEGRITY -->
<g id="edge41" class="edge">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M822.48,-3106.94C726.51,-2968.86 366.96,-2451.51 270.83,-2313.19"/>
<polygon fill="black" stroke="black" points="273.47,-2310.85 264.89,-2304.63 267.72,-2314.84 273.47,-2310.85"/>
<text text-anchor="middle" x="540.65" y="-2738.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure0 -->
<g id="node38" class="node">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1857.15,-3450 1363.15,-3450 1363.15,-3354 1857.15,-3354 1857.15,-3450"/>
<text text-anchor="start" x="1378.65" y="-3435.4" font-family="Arial" font-weight="bold" font-size="12.00"> Use High Entropy for Secrets (5_1_4_2_2_HIGH_ENTROPY_SECRETS) </text>
<text text-anchor="start" x="1386.15" y="-3411.4" font-family="Arial" font-size="12.00"> When creating secrets not intended for usage by human users (e.g., client</text>
<text text-anchor="start" x="1373.15" y="-3399.4" font-family="Arial" font-size="12.00">secrets or token handles), the authorization server should include a reasonable</text>
<text text-anchor="start" x="1386.15" y="-3387.4" font-family="Arial" font-size="12.00">level of entropy in order to mitigate the risk of guessing attacks. The token</text>
<text text-anchor="start" x="1387.15" y="-3375.4" font-family="Arial" font-size="12.00">value should be &gt;=128 bits long and constructed from a cryptographically</text>
<text text-anchor="start" x="1590.15" y="-3363.4" font-family="Arial" font-size="12.00">str[...] </text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure0&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE -->
<g id="edge36" class="edge">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure0&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE</title>
<path fill="none" stroke="black" d="M1363.03,-3380.66C1312.97,-3372.39 1261.24,-3360.92 1214.15,-3345 1096.84,-3305.36 973.71,-3228.24 904.37,-3181.01"/>
<polygon fill="black" stroke="black" points="906.01,-3177.89 895.78,-3175.12 902.05,-3183.66 906.01,-3177.89"/>
<text text-anchor="middle" x="1159.65" y="-3340.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure1 -->
<g id="node39" class="node">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1866.65,-3336 1353.65,-3336 1353.65,-3264 1866.65,-3264 1866.65,-3336"/>
<text text-anchor="start" x="1426.15" y="-3321.4" font-family="Arial" font-weight="bold" font-size="12.00"> Sign Self&#45;Contained Tokens (5_1_5_9_SIGNED_TOKEN) </text>
<text text-anchor="start" x="1369.15" y="-3297.4" font-family="Arial" font-size="12.00"> Self&#45;contained tokens should be signed in order to detect any attempt to modify</text>
<text text-anchor="start" x="1364.15" y="-3285.4" font-family="Arial" font-size="12.00">or produce faked tokens (e.g., Hash&#45;based Message Authentication Code or digital</text>
<text text-anchor="start" x="1573.65" y="-3273.4" font-family="Arial" font-size="12.00">signatures). </text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure1&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE -->
<g id="edge37" class="edge">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure1&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE</title>
<path fill="none" stroke="black" d="M1353.56,-3278.02C1306.93,-3271.99 1258.89,-3264.43 1214.15,-3255 1123.31,-3235.86 1022.8,-3203.73 950.13,-3178.45"/>
<polygon fill="black" stroke="black" points="951.11,-3175.09 940.51,-3175.09 948.8,-3181.69 951.11,-3175.09"/>
<text text-anchor="middle" x="1159.65" y="-3253.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure2 -->
<g id="node40" class="node">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure2</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1888.65,-3246 1331.65,-3246 1331.65,-3150 1888.65,-3150 1888.65,-3246"/>
<text text-anchor="start" x="1342.15" y="-3231.4" font-family="Arial" font-weight="bold" font-size="12.00"> Issue Installation&#45;Specific Client Secrets (5_2_3_4_SPECIFIC_CLIENT_SECRETS) </text>
<text text-anchor="start" x="1371.15" y="-3207.4" font-family="Arial" font-size="12.00"> An authorization server may issue separate client identifiers and corresponding</text>
<text text-anchor="start" x="1400.65" y="-3195.4" font-family="Arial" font-size="12.00">secrets to the different installations of a particular client (i.e., software</text>
<text text-anchor="start" x="1401.65" y="-3183.4" font-family="Arial" font-size="12.00">package). &#160;The effect of such an approach would be to turn otherwise</text>
<text text-anchor="start" x="1446.65" y="-3171.4" font-family="Arial" font-size="12.00">&quot;public&quot; clients back into &quot;confidential&quot; clients. For web</text>
<text text-anchor="start" x="1539.65" y="-3159.4" font-family="Arial" font-size="12.00">applications, this co[...] </text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure2&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE -->
<g id="edge38" class="edge">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure2&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE</title>
<path fill="none" stroke="black" d="M1331.45,-3177.2C1246.12,-3170.81 1153.35,-3163.86 1072.1,-3157.77"/>
<polygon fill="black" stroke="black" points="1071.97,-3154.26 1061.74,-3157 1071.45,-3161.24 1071.97,-3154.26"/>
<text text-anchor="middle" x="1159.65" y="-3169.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure3 -->
<g id="node41" class="node">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure3</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1908.65,-3132 1311.65,-3132 1311.65,-3036 1908.65,-3036 1908.65,-3132"/>
<text text-anchor="start" x="1322.15" y="-3117.4" font-family="Arial" font-weight="bold" font-size="12.00"> Binding of Authorization &quot;code&quot; to &quot;redirect_uri&quot; (5_2_4_5_REDIRECT_CODE_BINDING) </text>
<text text-anchor="start" x="1407.15" y="-3093.4" font-family="Arial" font-size="12.00"> The authorization server should be able to bind every authorization</text>
<text text-anchor="start" x="1413.15" y="-3081.4" font-family="Arial" font-size="12.00">&quot;code&quot; to the actual redirect URI used as the redirect target of the</text>
<text text-anchor="start" x="1381.65" y="-3069.4" font-family="Arial" font-size="12.00">client in the end&#45;user authorization process. This binding should be validated</text>
<text text-anchor="start" x="1411.15" y="-3057.4" font-family="Arial" font-size="12.00">when the client attempts to exchange the respective authorization</text>
<text text-anchor="start" x="1517.65" y="-3045.4" font-family="Arial" font-size="12.00">&quot;code&quot; for an access token[...] </text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure3&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE -->
<g id="edge39" class="edge">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure3&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE</title>
<path fill="none" stroke="black" d="M1311.38,-3106.3C1231.61,-3112.28 1146.74,-3118.63 1071.74,-3124.25"/>
<polygon fill="black" stroke="black" points="1071.41,-3120.77 1061.7,-3125 1071.93,-3127.75 1071.41,-3120.77"/>
<text text-anchor="middle" x="1159.65" y="-3122.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure4 -->
<g id="node42" class="node">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure4</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1832.65,-3018 1387.65,-3018 1387.65,-2922 1832.65,-2922 1832.65,-3018"/>
<text text-anchor="start" x="1409.15" y="-3003.4" font-family="Arial" font-weight="bold" font-size="12.00"> Use Short Expiration Time (5_1_5_3_SHORT_EXPIRY_CODE) </text>
<text text-anchor="start" x="1398.15" y="-2979.4" font-family="Arial" font-size="12.00"> A short expiration time for tokens is a means of protection against the</text>
<text text-anchor="start" x="1433.15" y="-2967.4" font-family="Arial" font-size="12.00">following threats: &lt;br/&gt;o replay &lt;br/&gt;o token leak (a short</text>
<text text-anchor="start" x="1409.65" y="-2955.4" font-family="Arial" font-size="12.00">expiration time will reduce impact) &lt;br/&gt;o online guessing (a short</text>
<text text-anchor="start" x="1399.65" y="-2943.4" font-family="Arial" font-size="12.00">expiration time will reduce the likelihood of success) Note: Short token</text>
<text text-anchor="start" x="1492.65" y="-2931.4" font-family="Arial" font-size="12.00">duration requires more precise cloc[...] </text>
</g>
<!-- 4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure4&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE -->
<g id="edge40" class="edge">
<title>4_4_1_3_AUTH_CODE_BRUTE_FORCE_countermeasure4&#45;&gt;4_4_1_3_AUTH_CODE_BRUTE_FORCE</title>
<path fill="none" stroke="black" d="M1387.6,-2995.66C1330.74,-3003.97 1269.9,-3014.38 1214.15,-3027 1124.54,-3047.29 1025.14,-3078.85 952.57,-3103.62"/>
<polygon fill="black" stroke="black" points="951.28,-3100.36 942.96,-3106.91 953.55,-3106.98 951.28,-3100.36"/>
<text text-anchor="middle" x="1159.65" y="-3050.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1 -->
<g id="node43" class="node">
<title>4_4_1_4_CLIENT_SPOOFING1</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1088.65,-2566.5 605.65,-2566.5 605.65,-2485.5 1088.65,-2485.5 1088.65,-2566.5"/>
<text text-anchor="start" x="722.65" y="-2551.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_1_4_CLIENT_SPOOFING1 ATTACK</text>
<text text-anchor="start" x="968.65" y="-2551.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="630.15" y="-2533.4" font-family="Arial" font-size="12.00">A malicious client could pretend to be a valid client and obtain an access</text>
<text text-anchor="start" x="634.65" y="-2520.4" font-family="Arial" font-size="12.00">authorization in this way. The malicious client could even utilize screen&#45;</text>
<text text-anchor="start" x="616.15" y="-2507.4" font-family="Arial" font-size="12.00">scraping techniques in order to simulate a user’s consent in the authorization</text>
<text text-anchor="start" x="833.65" y="-2494.4" font-family="Arial" font-size="12.00">flow.</text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1&#45;&gt;INTEGRITY -->
<g id="edge48" class="edge">
<title>4_4_1_4_CLIENT_SPOOFING1&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M747.89,-2485.49C626.42,-2435.4 422.73,-2351.43 316.42,-2307.59"/>
<polygon fill="black" stroke="black" points="317.65,-2304.31 307.07,-2303.74 314.98,-2310.78 317.65,-2304.31"/>
<text text-anchor="middle" x="540.65" y="-2412.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure0 -->
<g id="node44" class="node">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1888.65,-2904 1331.65,-2904 1331.65,-2808 1888.65,-2808 1888.65,-2904"/>
<text text-anchor="start" x="1342.15" y="-2889.4" font-family="Arial" font-weight="bold" font-size="12.00"> Issue Installation&#45;Specific Client Secrets (5_2_3_4_SPECIFIC_CLIENT_SECRETS) </text>
<text text-anchor="start" x="1371.15" y="-2865.4" font-family="Arial" font-size="12.00"> An authorization server may issue separate client identifiers and corresponding</text>
<text text-anchor="start" x="1400.65" y="-2853.4" font-family="Arial" font-size="12.00">secrets to the different installations of a particular client (i.e., software</text>
<text text-anchor="start" x="1401.65" y="-2841.4" font-family="Arial" font-size="12.00">package). &#160;The effect of such an approach would be to turn otherwise</text>
<text text-anchor="start" x="1446.65" y="-2829.4" font-family="Arial" font-size="12.00">&quot;public&quot; clients back into &quot;confidential&quot; clients. For web</text>
<text text-anchor="start" x="1539.65" y="-2817.4" font-family="Arial" font-size="12.00">applications, this co[...] </text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure0&#45;&gt;4_4_1_4_CLIENT_SPOOFING1 -->
<g id="edge42" class="edge">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure0&#45;&gt;4_4_1_4_CLIENT_SPOOFING1</title>
<path fill="none" stroke="black" d="M1331.64,-2833.85C1291.34,-2825.53 1251.04,-2814.26 1214.15,-2799 1085.24,-2745.7 960.62,-2636.68 895.3,-2573.73"/>
<polygon fill="black" stroke="black" points="897.63,-2571.12 888.01,-2566.67 892.75,-2576.14 897.63,-2571.12"/>
<text text-anchor="middle" x="1159.65" y="-2792.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure1 -->
<g id="node45" class="node">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1871.15,-2790 1349.15,-2790 1349.15,-2694 1871.15,-2694 1871.15,-2790"/>
<text text-anchor="start" x="1359.15" y="-2775.4" font-family="Arial" font-weight="bold" font-size="12.00"> Validate Pre&#45;Registered &quot;redirect_uri&quot; (5_2_3_5_VALIDATE_REDIRECT_URI) </text>
<text text-anchor="start" x="1415.65" y="-2751.4" font-family="Arial" font-size="12.00"> An authorization server should require all clients to register their</text>
<text text-anchor="start" x="1450.15" y="-2739.4" font-family="Arial" font-size="12.00">&quot;redirect_uri&quot;, and the &quot;redirect_uri&quot; should be the full</text>
<text text-anchor="start" x="1375.15" y="-2727.4" font-family="Arial" font-size="12.00">URI as defined in [RFC6749]. &#160;The way that this registration is performed is out</text>
<text text-anchor="start" x="1372.15" y="-2715.4" font-family="Arial" font-size="12.00">of scope of this document. &#160;As per the core spec, every actual redirect URI sent</text>
<text text-anchor="start" x="1541.15" y="-2703.4" font-family="Arial" font-size="12.00">with the respective[...] </text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure1&#45;&gt;4_4_1_4_CLIENT_SPOOFING1 -->
<g id="edge43" class="edge">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure1&#45;&gt;4_4_1_4_CLIENT_SPOOFING1</title>
<path fill="none" stroke="black" d="M1348.91,-2714.52C1303.54,-2706.88 1257.14,-2697.2 1214.15,-2685 1114.76,-2656.79 1006.97,-2607.49 934.29,-2571.25"/>
<polygon fill="black" stroke="black" points="935.67,-2568.03 925.16,-2566.67 932.53,-2574.28 935.67,-2568.03"/>
<text text-anchor="middle" x="1159.65" y="-2681.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure2 -->
<g id="node46" class="node">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure2</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1934.65,-2676 1285.65,-2676 1285.65,-2592 1934.65,-2592 1934.65,-2676"/>
<text text-anchor="start" x="1296.15" y="-2661.4" font-family="Arial" font-weight="bold" font-size="12.00"> Validation of Client Properties by End User (5_2_4_3_VALIDATION_OF_CLIENT_BY_END_USER) </text>
<text text-anchor="start" x="1382.15" y="-2637.4" font-family="Arial" font-size="12.00"> In the authorization process, the user is typically asked to approve a client’s</text>
<text text-anchor="start" x="1385.65" y="-2625.4" font-family="Arial" font-size="12.00">request for authorization. This is an important security mechanism by itself</text>
<text text-anchor="start" x="1387.15" y="-2613.4" font-family="Arial" font-size="12.00">because the end user can be involved in the validation of client properties,</text>
<text text-anchor="start" x="1374.65" y="-2601.4" font-family="Arial" font-size="12.00">such as whether the client name known to the authorization server fits the[...] </text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure2&#45;&gt;4_4_1_4_CLIENT_SPOOFING1 -->
<g id="edge44" class="edge">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure2&#45;&gt;4_4_1_4_CLIENT_SPOOFING1</title>
<path fill="none" stroke="black" d="M1285.44,-2592.9C1261.3,-2589.62 1237.34,-2586.3 1214.15,-2583 1176.89,-2577.69 1137.54,-2571.84 1099,-2565.95"/>
<polygon fill="black" stroke="black" points="1099.11,-2562.43 1088.69,-2564.38 1098.05,-2569.35 1099.11,-2562.43"/>
<text text-anchor="middle" x="1159.65" y="-2583.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure3 -->
<g id="node47" class="node">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure3</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="2006.15,-2574 1214.15,-2574 1214.15,-2478 2006.15,-2478 2006.15,-2574"/>
<text text-anchor="start" x="1224.15" y="-2559.4" font-family="Arial" font-weight="bold" font-size="12.00"> Automatic Processing of Repeated Authorizations Requires Client Validation (5_2_4_1_REPEAT_VALIDATE_CLIENT) </text>
<text text-anchor="start" x="1375.15" y="-2535.4" font-family="Arial" font-size="12.00"> Authorization servers should NOT automatically process repeat authorizations</text>
<text text-anchor="start" x="1386.65" y="-2523.4" font-family="Arial" font-size="12.00">where the client is not authenticated through a client secret or some other</text>
<text text-anchor="start" x="1372.15" y="-2511.4" font-family="Arial" font-size="12.00">authentication mechanism such as a signed authentication assertion certificate</text>
<text text-anchor="start" x="1401.15" y="-2499.4" font-family="Arial" font-size="12.00">(Section 5.2.3.7) or validation of a pre&#45;registered redirect URI (Section</text>
<text text-anchor="start" x="1592.15" y="-2487.4" font-family="Arial" font-size="12.00">5.[...] </text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure3&#45;&gt;4_4_1_4_CLIENT_SPOOFING1 -->
<g id="edge45" class="edge">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure3&#45;&gt;4_4_1_4_CLIENT_SPOOFING1</title>
<path fill="none" stroke="black" d="M1213.88,-2526C1174.86,-2526 1136.06,-2526 1099.1,-2526"/>
<polygon fill="black" stroke="black" points="1098.73,-2522.5 1088.73,-2526 1098.73,-2529.5 1098.73,-2522.5"/>
<text text-anchor="middle" x="1159.65" y="-2529.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure4 -->
<g id="node48" class="node">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure4</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1992.65,-2460 1227.65,-2460 1227.65,-2364 1992.65,-2364 1992.65,-2460"/>
<text text-anchor="start" x="1238.15" y="-2445.4" font-family="Arial" font-weight="bold" font-size="12.00"> Automatic Processing of Repeated Authorizations Requires Client Validation (REQUIRE_USER_MANUAL_STEP) </text>
<text text-anchor="start" x="1383.15" y="-2421.4" font-family="Arial" font-size="12.00"> If the authorization server automatically authenticates the end user, it may</text>
<text text-anchor="start" x="1390.15" y="-2409.4" font-family="Arial" font-size="12.00">nevertheless require some user input in order to prevent screen scraping.</text>
<text text-anchor="start" x="1389.65" y="-2397.4" font-family="Arial" font-size="12.00">Examples are CAPTCHAs (Completely Automated Public Turing tests to tell</text>
<text text-anchor="start" x="1358.15" y="-2385.4" font-family="Arial" font-size="12.00">Computers and Humans Apart) or other multi&#45;factor authentication techniques such</text>
<text text-anchor="start" x="1587.15" y="-2373.4" font-family="Arial" font-size="12.00">as r[...] </text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure4&#45;&gt;4_4_1_4_CLIENT_SPOOFING1 -->
<g id="edge46" class="edge">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure4&#45;&gt;4_4_1_4_CLIENT_SPOOFING1</title>
<path fill="none" stroke="black" d="M1274.54,-2460.02C1254.1,-2463.03 1233.85,-2466.04 1214.15,-2469 1176.93,-2474.58 1137.6,-2480.59 1099.07,-2486.54"/>
<polygon fill="black" stroke="black" points="1098.11,-2483.15 1088.77,-2488.13 1099.18,-2490.07 1098.11,-2483.15"/>
<text text-anchor="middle" x="1159.65" y="-2485.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure5 -->
<g id="node49" class="node">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure5</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1865.15,-2346 1355.15,-2346 1355.15,-2250 1865.15,-2250 1865.15,-2346"/>
<text text-anchor="start" x="1429.15" y="-2331.4" font-family="Arial" font-weight="bold" font-size="12.00"> Limit Token Scope (5_1_5_1_LIMITED_SCOPE_TOKEN) </text>
<text text-anchor="start" x="1365.15" y="-2307.4" font-family="Arial" font-size="12.00"> The authorization server may decide to reduce or limit the scope associated with</text>
<text text-anchor="start" x="1393.65" y="-2295.4" font-family="Arial" font-size="12.00">a token. The basis of this decision is out of scope; examples are: &lt;br/&gt;o</text>
<text text-anchor="start" x="1405.65" y="-2283.4" font-family="Arial" font-size="12.00">a client&#45;specific policy, e.g., issue only less powerful tokens to public</text>
<text text-anchor="start" x="1415.15" y="-2271.4" font-family="Arial" font-size="12.00">clients, &lt;br/&gt;o a service&#45;specific policy, e.g., it is a very sensitive</text>
<text text-anchor="start" x="1580.15" y="-2259.4" font-family="Arial" font-size="12.00">servic[...] </text>
</g>
<!-- 4_4_1_4_CLIENT_SPOOFING1_countermeasure5&#45;&gt;4_4_1_4_CLIENT_SPOOFING1 -->
<g id="edge47" class="edge">
<title>4_4_1_4_CLIENT_SPOOFING1_countermeasure5&#45;&gt;4_4_1_4_CLIENT_SPOOFING1</title>
<path fill="none" stroke="black" d="M1354.94,-2323.43C1307.6,-2331.33 1258.96,-2341.62 1214.15,-2355 1111.03,-2385.79 1000.04,-2441.1 927.66,-2480.48"/>
<polygon fill="black" stroke="black" points="925.68,-2477.57 918.59,-2485.44 929.04,-2483.71 925.68,-2477.57"/>
<text text-anchor="middle" x="1159.65" y="-2387.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_5_CLIENT_SPOOFING2 -->
<g id="node50" class="node">
<title>4_4_1_5_CLIENT_SPOOFING2</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1071.15,-2224.5 623.15,-2224.5 623.15,-2143.5 1071.15,-2143.5 1071.15,-2224.5"/>
<text text-anchor="start" x="722.15" y="-2209.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_1_5_CLIENT_SPOOFING2 ATTACK</text>
<text text-anchor="start" x="968.15" y="-2209.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="637.65" y="-2191.4" font-family="Arial" font-size="12.00">A hostile party could impersonate the client site and get access to the</text>
<text text-anchor="start" x="659.15" y="-2178.4" font-family="Arial" font-size="12.00">authorization &quot;code&quot;. This could be achieved using DNS or ARP</text>
<text text-anchor="start" x="639.65" y="-2165.4" font-family="Arial" font-size="12.00">spoofing. This applies to clients, which are web applications; thus, the</text>
<text text-anchor="start" x="633.15" y="-2152.4" font-family="Arial" font-size="12.00">redirect URI is not local to the host where the user’s browser is running.</text>
</g>
<!-- 4_4_1_5_CLIENT_SPOOFING2&#45;&gt;INTEGRITY -->
<g id="edge51" class="edge">
<title>4_4_1_5_CLIENT_SPOOFING2&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M648.16,-2224.55C622.3,-2229.35 596.12,-2233.97 571.15,-2238 523.19,-2245.73 471.04,-2252.88 422.88,-2258.97"/>
<polygon fill="black" stroke="black" points="422.15,-2255.53 412.66,-2260.25 423.02,-2262.48 422.15,-2255.53"/>
<text text-anchor="middle" x="540.65" y="-2249.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_1_5_CLIENT_SPOOFING2_countermeasure0 -->
<g id="node51" class="node">
<title>4_4_1_5_CLIENT_SPOOFING2_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1872.65,-2232 1347.65,-2232 1347.65,-2136 1872.65,-2136 1872.65,-2232"/>
<text text-anchor="start" x="1358.15" y="-2217.4" font-family="Arial" font-weight="bold" font-size="12.00"> TLS for the authorization server (5_1_2_AUTH_SERVER_AUTHENTICATION) </text>
<text text-anchor="start" x="1377.65" y="-2193.4" font-family="Arial" font-size="12.00"> Authorization servers should consider such attacks when developing services</text>
<text text-anchor="start" x="1376.15" y="-2181.4" font-family="Arial" font-size="12.00">based on OAuth and should require the use of transport&#45; layer security for any</text>
<text text-anchor="start" x="1393.65" y="-2169.4" font-family="Arial" font-size="12.00">requests where the authenticity of the authorization server or of request</text>
<text text-anchor="start" x="1392.65" y="-2157.4" font-family="Arial" font-size="12.00">responses is an issue (see Section 5.1.2). HTTPS server authentication or</text>
<text text-anchor="start" x="1586.15" y="-2145.4" font-family="Arial" font-size="12.00">simi[...] </text>
</g>
<!-- 4_4_1_5_CLIENT_SPOOFING2_countermeasure0&#45;&gt;4_4_1_5_CLIENT_SPOOFING2 -->
<g id="edge49" class="edge">
<title>4_4_1_5_CLIENT_SPOOFING2_countermeasure0&#45;&gt;4_4_1_5_CLIENT_SPOOFING2</title>
<path fill="none" stroke="black" d="M1347.52,-2184C1261.16,-2184 1165.71,-2184 1081.59,-2184"/>
<polygon fill="black" stroke="black" points="1081.39,-2180.5 1071.39,-2184 1081.39,-2187.5 1081.39,-2180.5"/>
<text text-anchor="middle" x="1159.65" y="-2187.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_5_CLIENT_SPOOFING2_countermeasure1 -->
<g id="node52" class="node">
<title>4_4_1_5_CLIENT_SPOOFING2_countermeasure1</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1900.65,-2118 1319.65,-2118 1319.65,-2022 1900.65,-2022 1900.65,-2118"/>
<text text-anchor="start" x="1330.15" y="-2103.4" font-family="Arial" font-weight="bold" font-size="12.00"> Binding of Authorization &quot;code&quot; to &quot;client_id&quot; (5_2_4_4_CLIENT_TO_CODE_BINDING) </text>
<text text-anchor="start" x="1397.65" y="-2079.4" font-family="Arial" font-size="12.00"> The authorization server should bind every authorization &quot;code&quot; to the</text>
<text text-anchor="start" x="1387.15" y="-2067.4" font-family="Arial" font-size="12.00">id of the respective client that initiated the end&#45;user authorization process.</text>
<text text-anchor="start" x="1387.15" y="-2055.4" font-family="Arial" font-size="12.00">This measure is a countermeasure against: &lt;br/&gt;o Replay of authorization</text>
<text text-anchor="start" x="1415.65" y="-2043.4" font-family="Arial" font-size="12.00">&quot;codes&quot; with different client credentials, since an attacker cannot</text>
<text text-anchor="start" x="1547.65" y="-2031.4" font-family="Arial" font-size="12.00">use another &quot;clie[...] </text>
</g>
<!-- 4_4_1_5_CLIENT_SPOOFING2_countermeasure1&#45;&gt;4_4_1_5_CLIENT_SPOOFING2 -->
<g id="edge50" class="edge">
<title>4_4_1_5_CLIENT_SPOOFING2_countermeasure1&#45;&gt;4_4_1_5_CLIENT_SPOOFING2</title>
<path fill="none" stroke="black" d="M1319.48,-2111.42C1283.99,-2116.61 1248.24,-2121.89 1214.15,-2127 1171.13,-2133.45 1125.3,-2140.47 1081.14,-2147.31"/>
<polygon fill="black" stroke="black" points="1080.5,-2143.87 1071.15,-2148.86 1081.57,-2150.79 1080.5,-2143.87"/>
<text text-anchor="middle" x="1159.65" y="-2143.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_6_CLIENT_SPOOFING3 -->
<g id="node53" class="node">
<title>4_4_1_6_CLIENT_SPOOFING3</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1088.65,-2061.5 605.65,-2061.5 605.65,-1980.5 1088.65,-1980.5 1088.65,-2061.5"/>
<text text-anchor="start" x="722.65" y="-2046.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_1_6_CLIENT_SPOOFING3 ATTACK</text>
<text text-anchor="start" x="968.65" y="-2046.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="620.15" y="-2028.4" font-family="Arial" font-size="12.00">A hostile party could impersonate the client site and impersonate the user’s</text>
<text text-anchor="start" x="616.15" y="-2015.4" font-family="Arial" font-size="12.00">session on this client. This could be achieved using DNS or ARP spoofing. This</text>
<text text-anchor="start" x="628.15" y="-2002.4" font-family="Arial" font-size="12.00">applies to clients, which are web applications; thus, the redirect URI is not</text>
<text text-anchor="start" x="688.65" y="-1989.4" font-family="Arial" font-size="12.00">local to the host where the user’s browser is running.</text>
</g>
<!-- 4_4_1_6_CLIENT_SPOOFING3&#45;&gt;INTEGRITY -->
<g id="edge53" class="edge">
<title>4_4_1_6_CLIENT_SPOOFING3&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M698.27,-2061.52C658.33,-2078.61 618.18,-2102.36 589.15,-2135 571.21,-2155.16 590.62,-2174.32 571.15,-2193 555.65,-2207.87 450.34,-2234.17 363.91,-2253.78"/>
<polygon fill="black" stroke="black" points="362.99,-2250.4 354.01,-2256.02 364.53,-2257.23 362.99,-2250.4"/>
<text text-anchor="middle" x="540.65" y="-2219.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_1_6_CLIENT_SPOOFING3_countermeasure0 -->
<g id="node54" class="node">
<title>4_4_1_6_CLIENT_SPOOFING3_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1872.65,-2004 1347.65,-2004 1347.65,-1908 1872.65,-1908 1872.65,-2004"/>
<text text-anchor="start" x="1358.15" y="-1989.4" font-family="Arial" font-weight="bold" font-size="12.00"> TLS for the authorization server (5_1_2_AUTH_SERVER_AUTHENTICATION) </text>
<text text-anchor="start" x="1377.65" y="-1965.4" font-family="Arial" font-size="12.00"> Authorization servers should consider such attacks when developing services</text>
<text text-anchor="start" x="1376.15" y="-1953.4" font-family="Arial" font-size="12.00">based on OAuth and should require the use of transport&#45; layer security for any</text>
<text text-anchor="start" x="1393.65" y="-1941.4" font-family="Arial" font-size="12.00">requests where the authenticity of the authorization server or of request</text>
<text text-anchor="start" x="1392.65" y="-1929.4" font-family="Arial" font-size="12.00">responses is an issue (see Section 5.1.2). HTTPS server authentication or</text>
<text text-anchor="start" x="1586.15" y="-1917.4" font-family="Arial" font-size="12.00">simi[...] </text>
</g>
<!-- 4_4_1_6_CLIENT_SPOOFING3_countermeasure0&#45;&gt;4_4_1_6_CLIENT_SPOOFING3 -->
<g id="edge52" class="edge">
<title>4_4_1_6_CLIENT_SPOOFING3_countermeasure0&#45;&gt;4_4_1_6_CLIENT_SPOOFING3</title>
<path fill="none" stroke="black" d="M1347.52,-1978.35C1267.1,-1985.22 1178.81,-1992.76 1099.13,-1999.56"/>
<polygon fill="black" stroke="black" points="1098.62,-1996.09 1088.95,-2000.43 1099.22,-2003.07 1098.62,-1996.09"/>
<text text-anchor="middle" x="1159.65" y="-1999.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4 -->
<g id="node55" class="node">
<title>4_4_1_7_CLIENT_SPOOFING4</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1075.65,-1775 618.65,-1775 618.65,-1681 1075.65,-1681 1075.65,-1775"/>
<text text-anchor="start" x="722.65" y="-1760.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_1_7_CLIENT_SPOOFING4 ATTACK</text>
<text text-anchor="start" x="968.65" y="-1760.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="653.65" y="-1742.4" font-family="Arial" font-size="12.00">The attacker leverages the authorization &quot;code&quot; grant type in an</text>
<text text-anchor="start" x="629.15" y="-1729.4" font-family="Arial" font-size="12.00">attempt to get another user (victim) to log in, authorize access to his/her</text>
<text text-anchor="start" x="635.65" y="-1716.4" font-family="Arial" font-size="12.00">resources, and subsequently obtain the authorization &quot;code&quot; and inject</text>
<text text-anchor="start" x="641.65" y="-1703.4" font-family="Arial" font-size="12.00">it into a client application using the attacker’s account. The goal is to</text>
<text text-anchor="start" x="768.15" y="-1690.4" font-family="Arial" font-size="12.00">associate an access au[...]</text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4&#45;&gt;INTEGRITY -->
<g id="edge58" class="edge">
<title>4_4_1_7_CLIENT_SPOOFING4&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M773.27,-1775C712.85,-1818.32 630.42,-1888.43 589.15,-1972 555.7,-2039.73 616.08,-2080.29 571.15,-2141 563.11,-2151.86 411.8,-2213.46 318.81,-2250.59"/>
<polygon fill="black" stroke="black" points="317.44,-2247.37 309.45,-2254.33 320.03,-2253.87 317.44,-2247.37"/>
<text text-anchor="middle" x="540.65" y="-2173.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4_countermeasure0 -->
<g id="node56" class="node">
<title>4_4_1_7_CLIENT_SPOOFING4_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1908.65,-1890 1311.65,-1890 1311.65,-1794 1908.65,-1794 1908.65,-1890"/>
<text text-anchor="start" x="1322.15" y="-1875.4" font-family="Arial" font-weight="bold" font-size="12.00"> Binding of Authorization &quot;code&quot; to &quot;redirect_uri&quot; (5_2_4_5_REDIRECT_CODE_BINDING) </text>
<text text-anchor="start" x="1407.15" y="-1851.4" font-family="Arial" font-size="12.00"> The authorization server should be able to bind every authorization</text>
<text text-anchor="start" x="1413.15" y="-1839.4" font-family="Arial" font-size="12.00">&quot;code&quot; to the actual redirect URI used as the redirect target of the</text>
<text text-anchor="start" x="1381.65" y="-1827.4" font-family="Arial" font-size="12.00">client in the end&#45;user authorization process. This binding should be validated</text>
<text text-anchor="start" x="1411.15" y="-1815.4" font-family="Arial" font-size="12.00">when the client attempts to exchange the respective authorization</text>
<text text-anchor="start" x="1517.65" y="-1803.4" font-family="Arial" font-size="12.00">&quot;code&quot; for an access token[...] </text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4_countermeasure0&#45;&gt;4_4_1_7_CLIENT_SPOOFING4 -->
<g id="edge54" class="edge">
<title>4_4_1_7_CLIENT_SPOOFING4_countermeasure0&#45;&gt;4_4_1_7_CLIENT_SPOOFING4</title>
<path fill="none" stroke="black" d="M1311.45,-1799.41C1278.61,-1794.6 1245.67,-1789.73 1214.15,-1785 1172.7,-1778.78 1128.63,-1772.04 1085.97,-1765.43"/>
<polygon fill="black" stroke="black" points="1086.44,-1761.97 1076.03,-1763.89 1085.37,-1768.88 1086.44,-1761.97"/>
<text text-anchor="middle" x="1159.65" y="-1785.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4_countermeasure1 -->
<g id="node57" class="node">
<title>4_4_1_7_CLIENT_SPOOFING4_countermeasure1</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1888.65,-1776 1331.65,-1776 1331.65,-1680 1888.65,-1680 1888.65,-1776"/>
<text text-anchor="start" x="1342.15" y="-1761.4" font-family="Arial" font-weight="bold" font-size="12.00"> Issue Installation&#45;Specific Client Secrets (5_2_3_4_SPECIFIC_CLIENT_SECRETS) </text>
<text text-anchor="start" x="1371.15" y="-1737.4" font-family="Arial" font-size="12.00"> An authorization server may issue separate client identifiers and corresponding</text>
<text text-anchor="start" x="1400.65" y="-1725.4" font-family="Arial" font-size="12.00">secrets to the different installations of a particular client (i.e., software</text>
<text text-anchor="start" x="1401.65" y="-1713.4" font-family="Arial" font-size="12.00">package). &#160;The effect of such an approach would be to turn otherwise</text>
<text text-anchor="start" x="1446.65" y="-1701.4" font-family="Arial" font-size="12.00">&quot;public&quot; clients back into &quot;confidential&quot; clients. For web</text>
<text text-anchor="start" x="1539.65" y="-1689.4" font-family="Arial" font-size="12.00">applications, this co[...] </text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4_countermeasure1&#45;&gt;4_4_1_7_CLIENT_SPOOFING4 -->
<g id="edge55" class="edge">
<title>4_4_1_7_CLIENT_SPOOFING4_countermeasure1&#45;&gt;4_4_1_7_CLIENT_SPOOFING4</title>
<path fill="none" stroke="black" d="M1331.45,-1728C1251.07,-1728 1164.08,-1728 1086.35,-1728"/>
<polygon fill="black" stroke="black" points="1085.94,-1724.5 1075.94,-1728 1085.94,-1731.5 1085.94,-1724.5"/>
<text text-anchor="middle" x="1159.65" y="-1731.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4_countermeasure2 -->
<g id="node58" class="node">
<title>4_4_1_7_CLIENT_SPOOFING4_countermeasure2</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1900.65,-1662 1319.65,-1662 1319.65,-1566 1900.65,-1566 1900.65,-1662"/>
<text text-anchor="start" x="1330.15" y="-1647.4" font-family="Arial" font-weight="bold" font-size="12.00"> Binding of Authorization &quot;code&quot; to &quot;client_id&quot; (5_2_4_4_CLIENT_TO_CODE_BINDING) </text>
<text text-anchor="start" x="1397.65" y="-1623.4" font-family="Arial" font-size="12.00"> The authorization server should bind every authorization &quot;code&quot; to the</text>
<text text-anchor="start" x="1387.15" y="-1611.4" font-family="Arial" font-size="12.00">id of the respective client that initiated the end&#45;user authorization process.</text>
<text text-anchor="start" x="1387.15" y="-1599.4" font-family="Arial" font-size="12.00">This measure is a countermeasure against: &lt;br/&gt;o Replay of authorization</text>
<text text-anchor="start" x="1415.65" y="-1587.4" font-family="Arial" font-size="12.00">&quot;codes&quot; with different client credentials, since an attacker cannot</text>
<text text-anchor="start" x="1547.65" y="-1575.4" font-family="Arial" font-size="12.00">use another &quot;clie[...] </text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4_countermeasure2&#45;&gt;4_4_1_7_CLIENT_SPOOFING4 -->
<g id="edge56" class="edge">
<title>4_4_1_7_CLIENT_SPOOFING4_countermeasure2&#45;&gt;4_4_1_7_CLIENT_SPOOFING4</title>
<path fill="none" stroke="black" d="M1319.48,-1655.42C1283.99,-1660.61 1248.24,-1665.89 1214.15,-1671 1172.7,-1677.22 1128.63,-1683.96 1085.97,-1690.57"/>
<polygon fill="black" stroke="black" points="1085.37,-1687.12 1076.03,-1692.11 1086.44,-1694.03 1085.37,-1687.12"/>
<text text-anchor="middle" x="1159.65" y="-1687.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4_countermeasure3 -->
<g id="node59" class="node">
<title>4_4_1_7_CLIENT_SPOOFING4_countermeasure3</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1855.65,-1548 1364.65,-1548 1364.65,-1476 1855.65,-1476 1855.65,-1548"/>
<text text-anchor="start" x="1458.15" y="-1533.4" font-family="Arial" font-weight="bold" font-size="12.00"> Implicit grant flow (IMPLICIT_GRANT_FLOW) </text>
<text text-anchor="start" x="1379.15" y="-1509.4" font-family="Arial" font-size="12.00"> The client may consider using other flows that are not vulnerable to this kind</text>
<text text-anchor="start" x="1375.15" y="-1497.4" font-family="Arial" font-size="12.00">of attack, such as the implicit grant type (see Section 4.4.2) or resource owner</text>
<text text-anchor="start" x="1486.15" y="-1485.4" font-family="Arial" font-size="12.00">password credentials (see Section 4.4.3). </text>
</g>
<!-- 4_4_1_7_CLIENT_SPOOFING4_countermeasure3&#45;&gt;4_4_1_7_CLIENT_SPOOFING4 -->
<g id="edge57" class="edge">
<title>4_4_1_7_CLIENT_SPOOFING4_countermeasure3&#45;&gt;4_4_1_7_CLIENT_SPOOFING4</title>
<path fill="none" stroke="black" d="M1364.42,-1527.39C1314.14,-1534.02 1261.97,-1543.49 1214.15,-1557 1115.6,-1584.83 1010.41,-1636.54 938.21,-1675.84"/>
<polygon fill="black" stroke="black" points="936.22,-1672.93 929.13,-1680.81 939.58,-1679.07 936.22,-1672.93"/>
<text text-anchor="middle" x="1159.65" y="-1588.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_13_CODE_SUBSTITUTION -->
<g id="node60" class="node">
<title>4_4_1_13_CODE_SUBSTITUTION</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1082.15,-1457 612.15,-1457 612.15,-1363 1082.15,-1363 1082.15,-1457"/>
<text text-anchor="start" x="712.65" y="-1442.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_1_13_CODE_SUBSTITUTION ATTACK</text>
<text text-anchor="start" x="977.65" y="-1442.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="632.15" y="-1424.4" font-family="Arial" font-size="12.00">An attacker could attempt to log into an application or web site &#160;using a</text>
<text text-anchor="start" x="622.15" y="-1411.4" font-family="Arial" font-size="12.00">victim’s identity. Applications relying on identity data &#160;provided by an OAuth</text>
<text text-anchor="start" x="638.15" y="-1398.4" font-family="Arial" font-size="12.00">protected service API to login users are &#160;vulnerable to this threat. This</text>
<text text-anchor="start" x="657.65" y="-1385.4" font-family="Arial" font-size="12.00">pattern can be found in so&#45;called &#160;&quot;social login&quot; scenarios. &#160;As a</text>
<text text-anchor="start" x="797.65" y="-1372.4" font-family="Arial" font-size="12.00">prerequisite, [...]</text>
</g>
<!-- 4_4_1_13_CODE_SUBSTITUTION&#45;&gt;INTEGRITY -->
<g id="edge61" class="edge">
<title>4_4_1_13_CODE_SUBSTITUTION&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M776.98,-1457.2C715.27,-1503.74 628.72,-1580.99 589.15,-1672 553.31,-1754.41 616.41,-1998.37 571.15,-2076 563.18,-2089.67 387.34,-2195.57 298.09,-2248.74"/>
<polygon fill="black" stroke="black" points="296.27,-2245.75 289.47,-2253.87 299.85,-2251.76 296.27,-2245.75"/>
<text text-anchor="middle" x="540.65" y="-2120.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_1_13_CODE_SUBSTITUTION_countermeasure0 -->
<g id="node61" class="node">
<title>4_4_1_13_CODE_SUBSTITUTION_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1842.65,-1458 1377.65,-1458 1377.65,-1362 1842.65,-1362 1842.65,-1458"/>
<text text-anchor="start" x="1400.15" y="-1443.4" font-family="Arial" font-weight="bold" font-size="12.00"> Clients indicate their ids in requests (IN_REQUEST_CLIENTID) </text>
<text text-anchor="start" x="1388.15" y="-1419.4" font-family="Arial" font-size="12.00"> All clients must indicate their client ids with every request to exchange an</text>
<text text-anchor="start" x="1411.15" y="-1407.4" font-family="Arial" font-size="12.00">authorization &quot;code&quot; for an access token. The authorization server</text>
<text text-anchor="start" x="1408.65" y="-1395.4" font-family="Arial" font-size="12.00">must validate whether the particular authorization &quot;code&quot; has been</text>
<text text-anchor="start" x="1389.65" y="-1383.4" font-family="Arial" font-size="12.00">issued to the particular client. If possible, the client shall be authenticated</text>
<text text-anchor="start" x="1572.15" y="-1371.4" font-family="Arial" font-size="12.00">beforehand. </text>
</g>
<!-- 4_4_1_13_CODE_SUBSTITUTION_countermeasure0&#45;&gt;4_4_1_13_CODE_SUBSTITUTION -->
<g id="edge59" class="edge">
<title>4_4_1_13_CODE_SUBSTITUTION_countermeasure0&#45;&gt;4_4_1_13_CODE_SUBSTITUTION</title>
<path fill="none" stroke="black" d="M1377.46,-1410C1287.27,-1410 1183.84,-1410 1092.48,-1410"/>
<polygon fill="black" stroke="black" points="1092.26,-1406.5 1082.26,-1410 1092.26,-1413.5 1092.26,-1406.5"/>
<text text-anchor="middle" x="1159.65" y="-1413.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_1_13_CODE_SUBSTITUTION_countermeasure1 -->
<g id="node62" class="node">
<title>4_4_1_13_CODE_SUBSTITUTION_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1858.65,-1344 1361.65,-1344 1361.65,-1272 1858.65,-1272 1858.65,-1344"/>
<text text-anchor="start" x="1394.65" y="-1329.4" font-family="Arial" font-weight="bold" font-size="12.00"> Secure User Login Protocol (SECURE_USER_LOGIN_PROTOCOL) </text>
<text text-anchor="start" x="1380.65" y="-1305.4" font-family="Arial" font-size="12.00"> Clients should use an appropriate protocol, such as OpenID (cf. [OPENID]) or</text>
<text text-anchor="start" x="1372.15" y="-1293.4" font-family="Arial" font-size="12.00">SAML (cf. [OASIS.sstc&#45;saml&#45;bindings&#45;1.1]) to implement user login. Both support</text>
<text text-anchor="start" x="1514.15" y="-1281.4" font-family="Arial" font-size="12.00">audience restrictions on clients. </text>
</g>
<!-- 4_4_1_13_CODE_SUBSTITUTION_countermeasure1&#45;&gt;4_4_1_13_CODE_SUBSTITUTION -->
<g id="edge60" class="edge">
<title>4_4_1_13_CODE_SUBSTITUTION_countermeasure1&#45;&gt;4_4_1_13_CODE_SUBSTITUTION</title>
<path fill="none" stroke="black" d="M1361.63,-1334.62C1312.71,-1340.33 1261.77,-1346.58 1214.15,-1353 1174.7,-1358.32 1132.93,-1364.39 1092.27,-1370.55"/>
<polygon fill="black" stroke="black" points="1091.6,-1367.12 1082.24,-1372.08 1092.65,-1374.04 1091.6,-1367.12"/>
<text text-anchor="middle" x="1159.65" y="-1368.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_1_TOKEN_LEAK1_NETWORK -->
<g id="node63" class="node">
<title>4_4_2_1_TOKEN_LEAK1_NETWORK</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1098.65,-1295.5 595.65,-1295.5 595.65,-1214.5 1098.65,-1214.5 1098.65,-1295.5"/>
<text text-anchor="start" x="705.15" y="-1280.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_2_1_TOKEN_LEAK1_NETWORK ATTACK</text>
<text text-anchor="start" x="986.15" y="-1280.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="616.65" y="-1262.4" font-family="Arial" font-size="12.00">This token might be eavesdropped by an attacker. The token is sent from the</text>
<text text-anchor="start" x="656.15" y="-1249.4" font-family="Arial" font-size="12.00">server to the client via a URI fragment of the redirect URI. If the</text>
<text text-anchor="start" x="606.15" y="-1236.4" font-family="Arial" font-size="12.00">communication is not secured or the endpoint is not secured, the token could be</text>
<text text-anchor="start" x="741.15" y="-1223.4" font-family="Arial" font-size="12.00">leaked by parsing the returned URI.</text>
</g>
<!-- 4_4_2_1_TOKEN_LEAK1_NETWORK&#45;&gt;INTEGRITY -->
<g id="edge63" class="edge">
<title>4_4_2_1_TOKEN_LEAK1_NETWORK&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M660.74,-1295.57C632.7,-1309.62 607.17,-1328.53 589.15,-1354 548.7,-1411.16 600.37,-1920.36 571.15,-1984 555.32,-2018.46 367.61,-2178.15 285.32,-2247.13"/>
<polygon fill="black" stroke="black" points="282.88,-2244.61 277.46,-2253.71 287.37,-2249.97 282.88,-2244.61"/>
<text text-anchor="middle" x="540.65" y="-2048.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_2_1_TOKEN_LEAK1_NETWORK_countermeasure0 -->
<g id="node64" class="node">
<title>4_4_2_1_TOKEN_LEAK1_NETWORK_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1879.65,-1254 1340.65,-1254 1340.65,-1158 1879.65,-1158 1879.65,-1254"/>
<text text-anchor="start" x="1351.15" y="-1239.4" font-family="Arial" font-weight="bold" font-size="12.00"> Ensure Confidentiality of Requests (TLS) (5_1_1_CONFIDENTIAL_REQUESTS) </text>
<text text-anchor="start" x="1392.65" y="-1215.4" font-family="Arial" font-size="12.00"> This is applicable to all requests sent from the client to the authorization</text>
<text text-anchor="start" x="1375.65" y="-1203.4" font-family="Arial" font-size="12.00">server or resource server. While OAuth provides a mechanism for verifying the</text>
<text text-anchor="start" x="1396.15" y="-1191.4" font-family="Arial" font-size="12.00">integrity of requests, it provides no guarantee of request confidentiality.</text>
<text text-anchor="start" x="1384.15" y="-1179.4" font-family="Arial" font-size="12.00">Unless further precautions are taken, eavesdroppers will have full access to</text>
<text text-anchor="start" x="1598.15" y="-1167.4" font-family="Arial" font-size="12.00">[...] </text>
</g>
<!-- 4_4_2_1_TOKEN_LEAK1_NETWORK_countermeasure0&#45;&gt;4_4_2_1_TOKEN_LEAK1_NETWORK -->
<g id="edge62" class="edge">
<title>4_4_2_1_TOKEN_LEAK1_NETWORK_countermeasure0&#45;&gt;4_4_2_1_TOKEN_LEAK1_NETWORK</title>
<path fill="none" stroke="black" d="M1340.58,-1223.29C1265.34,-1228.14 1183.7,-1233.39 1108.92,-1238.21"/>
<polygon fill="black" stroke="black" points="1108.64,-1234.72 1098.89,-1238.85 1109.09,-1241.7 1108.64,-1234.72"/>
<text text-anchor="middle" x="1159.65" y="-1239.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY -->
<g id="node65" class="node">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1035.15,-1037 659.15,-1037 659.15,-995 1035.15,-995 1035.15,-1037"/>
<text text-anchor="start" x="672.15" y="-1022.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY ATTACK</text>
<text text-anchor="start" x="1018.15" y="-1022.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="669.15" y="-1004.4" font-family="Arial" font-size="12.00">A malicious client could attempt to obtain a token by fraud.</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY&#45;&gt;INTEGRITY -->
<g id="edge66" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M794.49,-1037.11C732.99,-1065.38 633.08,-1121.9 589.15,-1206 556.67,-1268.17 593.91,-1770.66 571.15,-1837 539.32,-1929.75 348.69,-2159.64 275.58,-2245.74"/>
<polygon fill="black" stroke="black" points="272.7,-2243.73 268.88,-2253.61 278.03,-2248.26 272.7,-2243.73"/>
<text text-anchor="middle" x="540.65" y="-1941.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY&#45;&gt;INTEGRITY -->
<g id="edge72" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M795.3,-1037.01C734.11,-1065.33 634.02,-1122.08 589.15,-1206 549.8,-1279.57 591.08,-1499.99 571.15,-1581 504.34,-1852.43 330.28,-2146.4 268.89,-2244.78"/>
<polygon fill="black" stroke="black" points="265.82,-2243.09 263.48,-2253.42 271.76,-2246.81 265.82,-2243.09"/>
<text text-anchor="middle" x="540.65" y="-1764.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure0 -->
<g id="node66" class="node">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1871.15,-1140 1349.15,-1140 1349.15,-1044 1871.15,-1044 1871.15,-1140"/>
<text text-anchor="start" x="1359.15" y="-1125.4" font-family="Arial" font-weight="bold" font-size="12.00"> Validate Pre&#45;Registered &quot;redirect_uri&quot; (5_2_3_5_VALIDATE_REDIRECT_URI) </text>
<text text-anchor="start" x="1415.65" y="-1101.4" font-family="Arial" font-size="12.00"> An authorization server should require all clients to register their</text>
<text text-anchor="start" x="1450.15" y="-1089.4" font-family="Arial" font-size="12.00">&quot;redirect_uri&quot;, and the &quot;redirect_uri&quot; should be the full</text>
<text text-anchor="start" x="1375.15" y="-1077.4" font-family="Arial" font-size="12.00">URI as defined in [RFC6749]. &#160;The way that this registration is performed is out</text>
<text text-anchor="start" x="1372.15" y="-1065.4" font-family="Arial" font-size="12.00">of scope of this document. &#160;As per the core spec, every actual redirect URI sent</text>
<text text-anchor="start" x="1541.15" y="-1053.4" font-family="Arial" font-size="12.00">with the respective[...] </text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure0&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY -->
<g id="edge64" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure0&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY</title>
<path fill="none" stroke="black" d="M1349.09,-1087.37C1275.83,-1084.13 1196.21,-1078.78 1123.15,-1070 1064.38,-1062.94 999.36,-1050.39 947.3,-1039.17"/>
<polygon fill="black" stroke="black" points="947.92,-1035.72 937.4,-1037.02 946.43,-1042.56 947.92,-1035.72"/>
<text text-anchor="middle" x="1159.65" y="-1079.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure0&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY -->
<g id="edge67" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure0&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY</title>
<path fill="none" stroke="black" d="M1349.12,-1066.03C1249.64,-1056.1 1137.91,-1044.94 1045.25,-1035.68"/>
<polygon fill="black" stroke="black" points="1045.49,-1032.19 1035.2,-1034.68 1044.8,-1039.16 1045.49,-1032.19"/>
<text text-anchor="middle" x="1159.65" y="-1052.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure1 -->
<g id="node67" class="node">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1934.65,-1026 1285.65,-1026 1285.65,-942 1934.65,-942 1934.65,-1026"/>
<text text-anchor="start" x="1296.15" y="-1011.4" font-family="Arial" font-weight="bold" font-size="12.00"> Validation of Client Properties by End User (5_2_4_3_VALIDATION_OF_CLIENT_BY_END_USER) </text>
<text text-anchor="start" x="1382.15" y="-987.4" font-family="Arial" font-size="12.00"> In the authorization process, the user is typically asked to approve a client’s</text>
<text text-anchor="start" x="1385.65" y="-975.4" font-family="Arial" font-size="12.00">request for authorization. This is an important security mechanism by itself</text>
<text text-anchor="start" x="1387.15" y="-963.4" font-family="Arial" font-size="12.00">because the end user can be involved in the validation of client properties,</text>
<text text-anchor="start" x="1374.65" y="-951.4" font-family="Arial" font-size="12.00">such as whether the client name known to the authorization server fits the[...] </text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure1&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY -->
<g id="edge65" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure1&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY</title>
<path fill="none" stroke="black" d="M1285.59,-997.61C1204.03,-1001.03 1118.91,-1004.61 1045.66,-1007.69"/>
<polygon fill="black" stroke="black" points="1045.25,-1004.21 1035.41,-1008.13 1045.55,-1011.2 1045.25,-1004.21"/>
<text text-anchor="middle" x="1159.65" y="-1006.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure1&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY -->
<g id="edge68" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure1&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY</title>
<path fill="none" stroke="black" d="M1285.47,-976.75C1231.24,-977.23 1175.57,-978.77 1123.15,-982 1083.42,-984.45 1040.65,-988.86 1000.95,-993.72"/>
<polygon fill="black" stroke="black" points="1000.41,-990.26 990.92,-994.96 1001.28,-997.21 1000.41,-990.26"/>
<text text-anchor="middle" x="1159.65" y="-985.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure2 -->
<g id="node68" class="node">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure2</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="2006.15,-924 1214.15,-924 1214.15,-828 2006.15,-828 2006.15,-924"/>
<text text-anchor="start" x="1224.15" y="-909.4" font-family="Arial" font-weight="bold" font-size="12.00"> Automatic Processing of Repeated Authorizations Requires Client Validation (5_2_4_1_REPEAT_VALIDATE_CLIENT) </text>
<text text-anchor="start" x="1375.15" y="-885.4" font-family="Arial" font-size="12.00"> Authorization servers should NOT automatically process repeat authorizations</text>
<text text-anchor="start" x="1386.65" y="-873.4" font-family="Arial" font-size="12.00">where the client is not authenticated through a client secret or some other</text>
<text text-anchor="start" x="1372.15" y="-861.4" font-family="Arial" font-size="12.00">authentication mechanism such as a signed authentication assertion certificate</text>
<text text-anchor="start" x="1401.15" y="-849.4" font-family="Arial" font-size="12.00">(Section 5.2.3.7) or validation of a pre&#45;registered redirect URI (Section</text>
<text text-anchor="start" x="1592.15" y="-837.4" font-family="Arial" font-size="12.00">5.[...] </text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure2&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY -->
<g id="edge69" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure2&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY</title>
<path fill="none" stroke="black" d="M1264.73,-924.04C1247.6,-926.95 1230.67,-929.94 1214.15,-933 1120.95,-950.26 1015.49,-974.71 941.8,-992.6"/>
<polygon fill="black" stroke="black" points="940.95,-989.2 932.07,-994.97 942.61,-996 940.95,-989.2"/>
<text text-anchor="middle" x="1159.65" y="-954.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure3 -->
<g id="node69" class="node">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure3</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1992.65,-810 1227.65,-810 1227.65,-714 1992.65,-714 1992.65,-810"/>
<text text-anchor="start" x="1238.15" y="-795.4" font-family="Arial" font-weight="bold" font-size="12.00"> Automatic Processing of Repeated Authorizations Requires Client Validation (REQUIRE_USER_MANUAL_STEP) </text>
<text text-anchor="start" x="1383.15" y="-771.4" font-family="Arial" font-size="12.00"> If the authorization server automatically authenticates the end user, it may</text>
<text text-anchor="start" x="1390.15" y="-759.4" font-family="Arial" font-size="12.00">nevertheless require some user input in order to prevent screen scraping.</text>
<text text-anchor="start" x="1389.65" y="-747.4" font-family="Arial" font-size="12.00">Examples are CAPTCHAs (Completely Automated Public Turing tests to tell</text>
<text text-anchor="start" x="1358.15" y="-735.4" font-family="Arial" font-size="12.00">Computers and Humans Apart) or other multi&#45;factor authentication techniques such</text>
<text text-anchor="start" x="1587.15" y="-723.4" font-family="Arial" font-size="12.00">as r[...] </text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure3&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY -->
<g id="edge70" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure3&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY</title>
<path fill="none" stroke="black" d="M1243.28,-810.07C1233.42,-812.88 1223.69,-815.85 1214.15,-819 1086.84,-860.98 951.57,-945.77 886.93,-989.13"/>
<polygon fill="black" stroke="black" points="884.62,-986.47 878.29,-994.97 888.53,-992.27 884.62,-986.47"/>
<text text-anchor="middle" x="1159.65" y="-855.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure4 -->
<g id="node70" class="node">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure4</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1865.15,-696 1355.15,-696 1355.15,-600 1865.15,-600 1865.15,-696"/>
<text text-anchor="start" x="1429.15" y="-681.4" font-family="Arial" font-weight="bold" font-size="12.00"> Limit Token Scope (5_1_5_1_LIMITED_SCOPE_TOKEN) </text>
<text text-anchor="start" x="1365.15" y="-657.4" font-family="Arial" font-size="12.00"> The authorization server may decide to reduce or limit the scope associated with</text>
<text text-anchor="start" x="1393.65" y="-645.4" font-family="Arial" font-size="12.00">a token. The basis of this decision is out of scope; examples are: &lt;br/&gt;o</text>
<text text-anchor="start" x="1405.65" y="-633.4" font-family="Arial" font-size="12.00">a client&#45;specific policy, e.g., issue only less powerful tokens to public</text>
<text text-anchor="start" x="1415.15" y="-621.4" font-family="Arial" font-size="12.00">clients, &lt;br/&gt;o a service&#45;specific policy, e.g., it is a very sensitive</text>
<text text-anchor="start" x="1580.15" y="-609.4" font-family="Arial" font-size="12.00">servic[...] </text>
</g>
<!-- 4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure4&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY -->
<g id="edge71" class="edge">
<title>4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY_countermeasure4&#45;&gt;4_4_2_2_TOKEN_LEAK2_BROWSER_HISTORY</title>
<path fill="none" stroke="black" d="M1355.04,-663.24C1306.86,-672.04 1257.88,-685.27 1214.15,-705 1062.85,-773.26 925.55,-923.41 871.95,-986.82"/>
<polygon fill="black" stroke="black" points="868.99,-984.91 865.25,-994.82 874.35,-989.41 868.99,-984.91"/>
<text text-anchor="middle" x="1159.65" y="-751.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_4_MANIPULATION_SCRIPTS -->
<g id="node71" class="node">
<title>4_4_2_4_MANIPULATION_SCRIPTS</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1098.15,-517.5 596.15,-517.5 596.15,-436.5 1098.15,-436.5 1098.15,-517.5"/>
<text text-anchor="start" x="705.15" y="-502.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_2_4_MANIPULATION_SCRIPTS ATTACK</text>
<text text-anchor="start" x="985.15" y="-502.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="621.65" y="-484.4" font-family="Arial" font-size="12.00">A hostile party could act as the client web server and replace or modify the</text>
<text text-anchor="start" x="614.65" y="-471.4" font-family="Arial" font-size="12.00">actual implementation of the client (script). This could be achieved using DNS</text>
<text text-anchor="start" x="606.15" y="-458.4" font-family="Arial" font-size="12.00">or ARP spoofing. This applies to clients implemented within the web browser in a</text>
<text text-anchor="start" x="789.65" y="-445.4" font-family="Arial" font-size="12.00">scripting language.</text>
</g>
<!-- 4_4_2_4_MANIPULATION_SCRIPTS&#45;&gt;INTEGRITY -->
<g id="edge76" class="edge">
<title>4_4_2_4_MANIPULATION_SCRIPTS&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M819.89,-517.62C767.03,-601.46 647.82,-801.32 589.15,-986 572.68,-1037.82 582.41,-1053.81 571.15,-1107 474.8,-1561.85 304.37,-2101.51 258.64,-2243.41"/>
<polygon fill="black" stroke="black" points="255.18,-2242.71 255.44,-2253.3 261.85,-2244.86 255.18,-2242.71"/>
<text text-anchor="middle" x="540.65" y="-1369.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_2_4_MANIPULATION_SCRIPTS_countermeasure0 -->
<g id="node72" class="node">
<title>4_4_2_4_MANIPULATION_SCRIPTS_countermeasure0</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1872.65,-582 1347.65,-582 1347.65,-486 1872.65,-486 1872.65,-582"/>
<text text-anchor="start" x="1358.15" y="-567.4" font-family="Arial" font-weight="bold" font-size="12.00"> TLS for the authorization server (5_1_2_AUTH_SERVER_AUTHENTICATION) </text>
<text text-anchor="start" x="1377.65" y="-543.4" font-family="Arial" font-size="12.00"> Authorization servers should consider such attacks when developing services</text>
<text text-anchor="start" x="1376.15" y="-531.4" font-family="Arial" font-size="12.00">based on OAuth and should require the use of transport&#45; layer security for any</text>
<text text-anchor="start" x="1393.65" y="-519.4" font-family="Arial" font-size="12.00">requests where the authenticity of the authorization server or of request</text>
<text text-anchor="start" x="1392.65" y="-507.4" font-family="Arial" font-size="12.00">responses is an issue (see Section 5.1.2). HTTPS server authentication or</text>
<text text-anchor="start" x="1586.15" y="-495.4" font-family="Arial" font-size="12.00">simi[...] </text>
</g>
<!-- 4_4_2_4_MANIPULATION_SCRIPTS_countermeasure0&#45;&gt;4_4_2_4_MANIPULATION_SCRIPTS -->
<g id="edge73" class="edge">
<title>4_4_2_4_MANIPULATION_SCRIPTS_countermeasure0&#45;&gt;4_4_2_4_MANIPULATION_SCRIPTS</title>
<path fill="none" stroke="black" d="M1347.52,-514.4C1270.25,-508.62 1185.71,-502.28 1108.53,-496.5"/>
<polygon fill="black" stroke="black" points="1108.41,-492.98 1098.17,-495.73 1107.89,-499.96 1108.41,-492.98"/>
<text text-anchor="middle" x="1159.65" y="-505.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_4_MANIPULATION_SCRIPTS_countermeasure1 -->
<g id="node73" class="node">
<title>4_4_2_4_MANIPULATION_SCRIPTS_countermeasure1</title>
<polygon fill="#d5e8d4" stroke="#82b366" points="1879.65,-468 1340.65,-468 1340.65,-372 1879.65,-372 1879.65,-468"/>
<text text-anchor="start" x="1351.15" y="-453.4" font-family="Arial" font-weight="bold" font-size="12.00"> Ensure Confidentiality of Requests (TLS) (5_1_1_CONFIDENTIAL_REQUESTS) </text>
<text text-anchor="start" x="1392.65" y="-429.4" font-family="Arial" font-size="12.00"> This is applicable to all requests sent from the client to the authorization</text>
<text text-anchor="start" x="1375.65" y="-417.4" font-family="Arial" font-size="12.00">server or resource server. While OAuth provides a mechanism for verifying the</text>
<text text-anchor="start" x="1396.15" y="-405.4" font-family="Arial" font-size="12.00">integrity of requests, it provides no guarantee of request confidentiality.</text>
<text text-anchor="start" x="1384.15" y="-393.4" font-family="Arial" font-size="12.00">Unless further precautions are taken, eavesdroppers will have full access to</text>
<text text-anchor="start" x="1598.15" y="-381.4" font-family="Arial" font-size="12.00">[...] </text>
</g>
<!-- 4_4_2_4_MANIPULATION_SCRIPTS_countermeasure1&#45;&gt;4_4_2_4_MANIPULATION_SCRIPTS -->
<g id="edge74" class="edge">
<title>4_4_2_4_MANIPULATION_SCRIPTS_countermeasure1&#45;&gt;4_4_2_4_MANIPULATION_SCRIPTS</title>
<path fill="none" stroke="black" d="M1340.58,-440.12C1265.14,-445.77 1183.25,-451.9 1108.31,-457.51"/>
<polygon fill="black" stroke="black" points="1107.97,-454.03 1098.26,-458.27 1108.49,-461.01 1107.97,-454.03"/>
<text text-anchor="middle" x="1159.65" y="-458.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_4_MANIPULATION_SCRIPTS_countermeasure2 -->
<g id="node74" class="node">
<title>4_4_2_4_MANIPULATION_SCRIPTS_countermeasure2</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1890.65,-354 1329.65,-354 1329.65,-270 1890.65,-270 1890.65,-354"/>
<text text-anchor="start" x="1340.15" y="-339.4" font-family="Arial" font-weight="bold" font-size="12.00"> One&#45;time, per&#45;use secrets (e.g., &quot;client_secret&quot;) (ONE_TIME_PER_USE_SECRET) </text>
<text text-anchor="start" x="1416.65" y="-315.4" font-family="Arial" font-size="12.00"> Introduce one&#45;time, per&#45;use secrets (e.g., &quot;client_secret&quot;) values</text>
<text text-anchor="start" x="1385.15" y="-303.4" font-family="Arial" font-size="12.00">that can only be used by scripts in a small time window once loaded from a</text>
<text text-anchor="start" x="1383.65" y="-291.4" font-family="Arial" font-size="12.00">server. The intention would be to reduce the effectiveness of copying client&#45;</text>
<text text-anchor="start" x="1449.15" y="-279.4" font-family="Arial" font-size="12.00">side scripts for re&#45;use in an attacker’s modified code. </text>
</g>
<!-- 4_4_2_4_MANIPULATION_SCRIPTS_countermeasure2&#45;&gt;4_4_2_4_MANIPULATION_SCRIPTS -->
<g id="edge75" class="edge">
<title>4_4_2_4_MANIPULATION_SCRIPTS_countermeasure2&#45;&gt;4_4_2_4_MANIPULATION_SCRIPTS</title>
<path fill="none" stroke="black" d="M1329.45,-341.97C1290.54,-347.93 1251.21,-354.9 1214.15,-363 1131.56,-381.05 1040.82,-409.26 970.35,-433.09"/>
<polygon fill="black" stroke="black" points="968.88,-429.9 960.54,-436.43 971.14,-436.52 968.88,-429.9"/>
<text text-anchor="middle" x="1159.65" y="-386.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_5_CSRF_IMPLICIT -->
<g id="node75" class="node">
<title>4_4_2_5_CSRF_IMPLICIT</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1091.15,-244.5 603.15,-244.5 603.15,-163.5 1091.15,-163.5 1091.15,-244.5"/>
<text text-anchor="start" x="738.15" y="-229.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_2_5_CSRF_IMPLICIT ATTACK</text>
<text text-anchor="start" x="952.15" y="-229.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="618.65" y="-211.4" font-family="Arial" font-size="12.00">CSRF attacks (see Section 4.4.1.8) also work against the redirect URI used in</text>
<text text-anchor="start" x="613.15" y="-198.4" font-family="Arial" font-size="12.00">the implicit grant flow. An attacker could acquire an access token to their own</text>
<text text-anchor="start" x="617.15" y="-185.4" font-family="Arial" font-size="12.00">protected resources. He could then construct a redirect URI and embed their</text>
<text text-anchor="start" x="626.15" y="-172.4" font-family="Arial" font-size="12.00">access token in that URI. If he can trick the user into following the redi[...]</text>
</g>
<!-- 4_4_2_5_CSRF_IMPLICIT&#45;&gt;INTEGRITY -->
<g id="edge79" class="edge">
<title>4_4_2_5_CSRF_IMPLICIT&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M777.77,-244.64C718.13,-283.85 634.3,-348.82 589.15,-428 400.99,-757.91 272.51,-2014.65 250.45,-2243.22"/>
<polygon fill="black" stroke="black" points="246.95,-2243.03 249.48,-2253.32 253.92,-2243.7 246.95,-2243.03"/>
<text text-anchor="middle" x="540.65" y="-605.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_2_5_CSRF_IMPLICIT_countermeasure0 -->
<g id="node76" class="node">
<title>4_4_2_5_CSRF_IMPLICIT_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1948.15,-252 1272.15,-252 1272.15,-156 1948.15,-156 1948.15,-252"/>
<text text-anchor="start" x="1282.15" y="-237.4" font-family="Arial" font-weight="bold" font-size="12.00"> Link the authorization request with the redirect URI (state param) (STATE_PARAM_VALIDATION) </text>
<text text-anchor="start" x="1396.65" y="-213.4" font-family="Arial" font-size="12.00"> The &quot;state&quot; parameter should be used to link the authorization request</text>
<text text-anchor="start" x="1387.15" y="-201.4" font-family="Arial" font-size="12.00">with the redirect URI used to deliver the access token. This will ensure that</text>
<text text-anchor="start" x="1396.65" y="-189.4" font-family="Arial" font-size="12.00">the client is not tricked into completing any redirect callback unless it is</text>
<text text-anchor="start" x="1429.65" y="-177.4" font-family="Arial" font-size="12.00">linked to an authorization request initiated by the client. The</text>
<text text-anchor="start" x="1541.65" y="-165.4" font-family="Arial" font-size="12.00">&quot;state&quot; parameter [...] </text>
</g>
<!-- 4_4_2_5_CSRF_IMPLICIT_countermeasure0&#45;&gt;4_4_2_5_CSRF_IMPLICIT -->
<g id="edge77" class="edge">
<title>4_4_2_5_CSRF_IMPLICIT_countermeasure0&#45;&gt;4_4_2_5_CSRF_IMPLICIT</title>
<path fill="none" stroke="black" d="M1272.04,-204C1214.77,-204 1156.18,-204 1101.54,-204"/>
<polygon fill="black" stroke="black" points="1101.39,-200.5 1091.39,-204 1101.39,-207.5 1101.39,-200.5"/>
<text text-anchor="middle" x="1159.65" y="-207.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_5_CSRF_IMPLICIT_countermeasure1 -->
<g id="node77" class="node">
<title>4_4_2_5_CSRF_IMPLICIT_countermeasure1</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1869.65,-138 1350.65,-138 1350.65,-90 1869.65,-90 1869.65,-138"/>
<text text-anchor="start" x="1361.15" y="-123.4" font-family="Arial" font-weight="bold" font-size="12.00"> Users can be educated to not follow untrusted URLs (USER_EDUCATION) </text>
<text text-anchor="start" x="1370.15" y="-99.4" font-family="Arial" font-size="12.00"> Client developers and end users can be educated to not follow untrusted URLs. </text>
</g>
<!-- 4_4_2_5_CSRF_IMPLICIT_countermeasure1&#45;&gt;4_4_2_5_CSRF_IMPLICIT -->
<g id="edge78" class="edge">
<title>4_4_2_5_CSRF_IMPLICIT_countermeasure1&#45;&gt;4_4_2_5_CSRF_IMPLICIT</title>
<path fill="none" stroke="black" d="M1350.46,-132.95C1304.98,-137.04 1258.13,-141.74 1214.15,-147 1177.66,-151.36 1139.22,-156.61 1101.53,-162.14"/>
<polygon fill="black" stroke="black" points="1100.82,-158.71 1091.44,-163.63 1101.85,-165.64 1100.82,-158.71"/>
<text text-anchor="middle" x="1159.65" y="-161.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
<!-- 4_4_2_6_TOKEN_SUBSTITUTION -->
<g id="node78" class="node">
<title>4_4_2_6_TOKEN_SUBSTITUTION</title>
<polygon fill="#f8cecc" stroke="#b85450" points="1087.65,-114 606.65,-114 606.65,-20 1087.65,-20 1087.65,-114"/>
<text text-anchor="start" x="713.15" y="-99.4" font-family="Arial" font-weight="bold" font-size="12.00">4_4_2_6_TOKEN_SUBSTITUTION ATTACK</text>
<text text-anchor="start" x="978.15" y="-99.4" font-family="Arial" font-size="12.00"> </text>
<text text-anchor="start" x="634.65" y="-81.4" font-family="Arial" font-size="12.00">An attacker could attempt to log into an application or web site using a</text>
<text text-anchor="start" x="624.65" y="-68.4" font-family="Arial" font-size="12.00">victim’s identity. Applications relying on identity data provided by an OAuth</text>
<text text-anchor="start" x="617.15" y="-55.4" font-family="Arial" font-size="12.00">protected service API to login users are vulnerable to this threat. This pattern</text>
<text text-anchor="start" x="646.15" y="-42.4" font-family="Arial" font-size="12.00">can be found in so&#45;called &quot;social login&quot; scenarios. As a prerequisite,</text>
<text text-anchor="start" x="822.65" y="-29.4" font-family="Arial" font-size="12.00">a res[...]</text>
</g>
<!-- 4_4_2_6_TOKEN_SUBSTITUTION&#45;&gt;INTEGRITY -->
<g id="edge81" class="edge">
<title>4_4_2_6_TOKEN_SUBSTITUTION&#45;&gt;INTEGRITY</title>
<path fill="none" stroke="black" d="M643.37,-114.03C623.21,-124.95 604.55,-138.41 589.15,-155 494.74,-256.67 537.66,-321.02 510.15,-457 365.83,-1170.29 270.11,-2056.17 250.72,-2243.29"/>
<polygon fill="black" stroke="black" points="247.22,-2243.08 249.67,-2253.39 254.18,-2243.8 247.22,-2243.08"/>
<text text-anchor="middle" x="540.65" y="-460.8" font-family="Times,serif" font-size="14.00"> impacts</text>
</g>
<!-- 4_4_2_6_TOKEN_SUBSTITUTION_countermeasure0 -->
<g id="node79" class="node">
<title>4_4_2_6_TOKEN_SUBSTITUTION_countermeasure0</title>
<polygon fill="#fff2cc" stroke="#d6b656" points="1858.65,-72 1361.65,-72 1361.65,0 1858.65,0 1858.65,-72"/>
<text text-anchor="start" x="1394.65" y="-57.4" font-family="Arial" font-weight="bold" font-size="12.00"> Secure User Login Protocol (SECURE_USER_LOGIN_PROTOCOL) </text>
<text text-anchor="start" x="1380.65" y="-33.4" font-family="Arial" font-size="12.00"> Clients should use an appropriate protocol, such as OpenID (cf. [OPENID]) or</text>
<text text-anchor="start" x="1372.15" y="-21.4" font-family="Arial" font-size="12.00">SAML (cf. [OASIS.sstc&#45;saml&#45;bindings&#45;1.1]) to implement user login. Both support</text>
<text text-anchor="start" x="1514.15" y="-9.4" font-family="Arial" font-size="12.00">audience restrictions on clients. </text>
</g>
<!-- 4_4_2_6_TOKEN_SUBSTITUTION_countermeasure0&#45;&gt;4_4_2_6_TOKEN_SUBSTITUTION -->
<g id="edge80" class="edge">
<title>4_4_2_6_TOKEN_SUBSTITUTION_countermeasure0&#45;&gt;4_4_2_6_TOKEN_SUBSTITUTION</title>
<path fill="none" stroke="black" d="M1361.55,-46.09C1277.03,-49.53 1182.52,-53.38 1097.84,-56.83"/>
<polygon fill="black" stroke="black" points="1097.68,-53.33 1087.83,-57.24 1097.96,-60.33 1097.68,-53.33"/>
<text text-anchor="middle" x="1159.65" y="-59.8" font-family="Times,serif" font-size="14.00"> mitigates</text>
</g>
</g>
</svg>
