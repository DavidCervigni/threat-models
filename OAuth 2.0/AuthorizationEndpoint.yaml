#based on: https://datatracker.ietf.org/doc/html/rfc6819

ID: AuthorizationEndpoint
title: Authorization Endpoint
parent: OAuth2.0
scope:  
  description:
  diagram:


  assumptions:
    - ID:
      description: |
        A Auth server may host several ...

  attackers:
    - ID: ANONYMOUS
      description: |
        Anonymous internet user
      inScope: true

    - ID: CLIENT
      description: |
        Client app
      inScope: true
  
analysis:

 
threats:
  - ID: AuthServerPhishing1
    title: Password Phishing by Counterfeit Authorization Server
    impact: Steal users' passwords
    impacts:
      - REFID: CONFIDENTIALITY
    assets:
      # - ID: 
    CVSS:
      vector: CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:N
    threatType: Spoofing, Elevation of privileges, Information Disclosure
    attack: |
      A hostile party could take advantage of this
      by intercepting the client's requests and returning misleading or
      otherwise incorrect responses.  This could be achieved using DNS or
      Address Resolution Protocol (ARP) spoofing.  Wide deployment of OAuth
      and similar protocols may cause users to become inured to the
      practice of being redirected to web sites where they are asked to
      enter their passwords.  If users are not careful to verify the
      authenticity of these web sites before entering their credentials, it
      will be possible for attackers to exploit this practice to steal
      users' passwords.
    pentestTestable: true
    public: true
    fullyMitigated: false
    countermeasures:
      - ID: AUTH_SERVER_TLS
        title: TLS for the authorization server
        description: |
          Authorization servers should consider such attacks when developing
          services based on OAuth and should require the use of transport-
          layer security for any requests where the authenticity of the
          authorization server or of request responses is an issue (see
          Section 5.1.2).
        operational: true
        inPlace: no
        public: true
        operator: AUTHORIZATION_SERVER


      - ID: USER_PHISHING_AWARENESS
        title: Users educated to avoid phishing attacks
        description: |
          Authorization servers should attempt to educate users about the
          risks posed by phishing attacks and should provide mechanisms that
          make it easy for users to confirm the authenticity of their sites.
          Section 5.1.2).
        operational: true
        inPlace: no
        public: true
        operator: AUTHORIZATION_SERVER


  - ID: TOO_MUCH_GRANT
    title: User Unintentionally Grants Too Much Access Scope
    impact: Disclosure of  RESOURCE_OWNER's RESOURCES
    impacts:
      - REFID: CONFIDENTIALITY
    assets:
      # - ID: 
    CVSS:
      vector: CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:N
    threatType: Spoofing, Elevation of privileges, Information Disclosure
    attack: |
      When obtaining end-user authorization, the end user may not
      understand the scope of the access being granted and to whom, or they
      may end up providing a client with access to resources that should
      not be permitted.
    pentestTestable: true
    public: true
    fullyMitigated: false
    countermeasures:
      - ID: AUTH_SERVER_RE_CHECK_GRANTS
        title: AUTHORIZATION_SERVER policy discretional decision
        description: |
          Narrow the scope, based on the client.  When obtaining end-user
          authorization and where the client requests scope, the
          authorization server may want to consider whether to honor that
          scope based on the client identifier.  That decision is between
          the client and authorization server and is outside the scope of
          this spec.  The authorization server may also want to consider
          what scope to grant based on the client type, e.g., providing
          lower scope to public clients (Section 5.1.5.1).
        operational: true
        inPlace: no
        public: true
        operator: AUTHORIZATION_SERVER

      - ID: USER_AUTH_AWARENESS
        title: Users educated to avoid phishing attacks
        description: |
          Authorization servers should attempt to educate users about the
          risks posed by phishing attacks and should provide mechanisms that
          make it easy for users to confirm the authenticity of their sites.
          Section 5.1.2).
        operator: AUTHORIZATION_SERVER
        operational: true
        inPlace: no
        public: true


  - ID: OPEN_REDIRECTOR
    title:  Authorization server open redirect
    impact: Phishing attacks can be executed exploiting AUTH_SERVER open redirect
    # impacts:
    #   - REFID: NON_REPUDIATION
    assets:
      - REFID: DF_AUTH_REDIRECT
      - REFID: AUTH_SERVER
    CVSS:
      vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:L/A:N
    threatType: Spoofing, Information Disclosure
    attack: |
      An attacker could use the end-user authorization endpoint and the
      redirect URI parameter to abuse the authorization server as an open
      redirector. An open redirector is an endpoint using a parameter to
      automatically redirect a user agent to the location specified by the
      parameter value without any validation.
    pentestTestable: true
    public: true
    fullyMitigated: false

    countermeasures:
      - ID: PRE-REGISTERED_REDIRECT_URI
        title: Pre-registered redirect URI
        description: |
          Require clients to register any full redirect URIs (Section 5.2.3.5).
          Don’t redirect to a redirect URI if the client identifier or
          redirect URI can’t be verified (Section 5.2.3.5).
          Authorization servers should not automatically process repeat
          authorizations to public clients unless the client is validated
          using a pre-registered redirect URI (Section 5.2.3.5).
        operational: false
        inPlace: true
        public: true



  - ID: PUBLIC_CLIENT_SPOOFING1
    title:  Malicious Client Obtains Existing Authorization by Fraud
    impact: Disclosure of RESOURCE_OWNER's RESOURCES
    impacts:
      - REFID: CONFIDENTIALITY
    assets:
      - REFID: DF_AUTH_REDIRECT
      - REFID: PUBLIC_CLIENT
    CVSS:
      vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N
    threatType: Spoofing, Elevation of privileges, Information Disclosure
    attack: |
      Authorization servers may wish to automatically process authorization
      requests from clients that have been previously authorized by the
      user. When the user is redirected to the authorization server's end-
      user authorization endpoint to grant access, the authorization server
      detects that the user has already granted access to that particular
      client. Instead of prompting the user for approval, the
      authorization server automatically redirects the user back to the
      client.

      A malicious client may exploit that feature and try to obtain such an
      authorization "code" instead of the legitimate client.
    pentestTestable: true
    public: true
    fullyMitigated: false

    countermeasures:
      - REFID: PRE-REGISTERED_REDIRECT_URI


      - ID: REDUCED_ACCESS_TOKEN_SCOPE
        title: Limiting the scope of access tokens obtained through automated approvals
        description: |
          Authorization servers can mitigate the risks associated with
          automatic processing by limiting the scope of access tokens
          obtained through automated approvals (Section 5.1.5.1).
        operator: AUTHORIZATION_SERVER
        operational: true
        inPlace: false
        public: true